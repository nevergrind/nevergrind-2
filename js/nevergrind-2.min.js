!function(e,i,a,t,n,o,l,s,r,c,d,u,m,h,p,f,g,y,v,b,w,k,B,H,S,A,D,C,W,T,M,E,j){"use strict";var I={checkMobile:function(){var e=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(e=!0),e}};I.isMobile=I.checkMobile();var L={selected:0,base:{str:0,sta:0,agi:0,dex:0,wis:0,intel:0,cha:0},form:{race:"",job:"",gender:"",name:"",str:0,sta:0,agi:0,dex:0,wis:0,intel:0,cha:0,left:10,maxLeft:10},possibleJobs:{},raceAttrs:{},jobAttrs:{},types:{Bard:"Utility",Cleric:"Healer",Druid:"Healer",Enchanter:"Utility",Magician:"Magical DPS",Monk:"Physical DPS",Necromancer:"Magical DPS",Paladin:"Tank",Ranger:"Physical DPS",Rogue:"Physical DPS",Shadowknight:"Tank",Shaman:"Healer",Warrior:"Tank",Wizard:"Magical DPS"},events:function(i){e("#logout").on(i,function(){O.logout()}),e("#ch-card-base").on(i,".ch-card",function(){e(".ch-card").removeClass("ch-card-active"),e(this).addClass("ch-card-active")}),e(".ch-card:first").trigger(i),e("#go-create-character").on(i,function(){O.goCreateCharacter()}),e("#delete-character").on(i,function(){F.show({key:"delete-character"})}),e(".select-race").on(i,function(i){var a=e(this).text();e(".select-race").removeClass("active"),e(this).addClass("active"),L.setRandomClass(a),L.set("race",a)}),e(".select-class").on(i,function(i){if(-1===e(this).get(0).className.indexOf("disabled")){var a=e(this).text();e(".select-class").removeClass("active"),e(this).addClass("active"),L.set("job",a)}}),e(".select-gender").on(i,function(){var i=e(this).attr("id");e(".select-gender").removeClass("active"),e(this).addClass("active"),L.set("gender",i)}),e("#create-character-name").on("change textInput input",function(){L.form.name=e(this).val().trim().replace(/ /g,"")}),e(".attr-minus-1").on(i,function(){var i=e(this).data("id");L.form.left<10&&L.form[i]-L.base[i]>0&&(a.getElementById("create-points-"+i).innerHTML=--L.form[i],a.getElementById("create-points-remaining").innerHTML=++L.form.left)}),e(".attr-add-1").on(i,function(){var i=e(this).data("id");L.form.left&&(a.getElementById("create-points-"+i).innerHTML=++L.form[i],a.getElementById("create-points-remaining").innerHTML=--L.form.left)}),e("#create-character-back").on(i,function(){O.lock(1),O.initGame();var e=a.getElementById("scene-title-create-character");n.to(e,.6,{y:20,opacity:0,onComplete:function(){n.set(e,{display:"none",opacity:1}),n.to("#scene-title-select-character",.6,{startAt:{display:"block",y:20,opacity:0},y:0,opacity:1,onComplete:function(){O.unlock()}})}})}),e("#create-character-btn").on(i,function(){if(!O.locked){O.lock(1);var a=L.form,t="";a.name?a.name.length>16?t="Your character name must be 16 characters or less!":a.left&&(t="You must spend all of your ability points!"):(t="Your character needs a name!",e("#create-character-name").focus()),t?(O.msg(t),O.unlock()):(a.shortJob=O.toJobShort(a.job),e.ajax({url:app.url+"php2/create/create-character.php",data:{form:a}}).done(function(a){console.info("Created character: ",a),O.msg(a.hero.name+" has been created!"),e("#create-character-back").trigger(i)}).fail(function(e){O.msg(e.responseText,8),O.unlock()}))}}),e("#ch-card-list").on(i,".select-player-card",function(){var i=e(this);L.selected=i.data("row"),L.name=i.data("name");1==O.playerCardClicks++&&e.ajax({type:"GET",url:app.url+"php2/session/init-character.php"})})},deleteCharacter:function(){O.locked||(O.lock(),e.ajax({url:app.url+"php2/create/delete-character.php",data:{row:L.selected}}).done(function(e){console.info("Deleted character: ",e),O.msg(L.name+" has been deleted!"),F.hide(),O.initGame()}).fail(function(e){O.msg(e.responseText,8),O.unlock()}))},msg:function(e,i){return{gender:{Male:"Males have strong cold and arcane resistance.",Female:"Females receive a boost to bleed and poison resistance."},race:{Barbarian:"Barbarians are a hardy race that benefit from high strength and stamina. Living through harsh winters in Fenwoven has given them strong cold resistance and above-average scouting skills.","Dark Elf":"Dark Elves are an evil race from Vedria that excel in a variety of roles. They boast strong blood and arcane resistance along with good trap and scouting skills.",Dwarf:"Dwarves hail from Dunhoven, a mountainous region of Vandamor. They are a stout, loyal race with strong resistances to arcane and poison magic. They are also known for unearthing hidden treasures where others would not.",Erudite:"Erudites are a learned race hailing from the remote island city of Wexxen. Generations of intense academic pursuit has made their bodies weak, but their minds strong. They also boast higher than normal pulling skills, which helps them avoid unnecessary conflicts in dungeons.",Gnome:"Gnomes hail from Brindomir, a mountainous city on the eastern outskirts of Vandamor. Due to their extensive tinkering and scientific experimentation, they have high lightning resistance and are immune to silence. They also have a small bonus to treasure-finding.","Half Elf":"Half Elves are a hybrid of Humans and Wood Elves that primarily dwell in Prentia, a city in western Vandamor. They share a blend of traits from both races and a love of the great outdoors. They have a minor boost to all resists and strong dungeon skills.",Halfling:"Halflings dwell in Aspen Grove, a hamlet on the southern coast of Vandamor. They are a race of nimble pranksters with high agility and dexterity. They are adept treasure-finders with strong bonuses to disarming traps and pulling. Their unique ability to escape from combat is unmatched.","High Elf":"High Elves live in Kaedorn, a walled kingdom ruled by a monarchy for thousands of years. Despite their resemblance to Wood Elves, their strengths are in spellcasting due to their diligent study of magic. They regenerate magic faster than any other race.",Human:"Humans are a swashbuckling, fearless race hailing from Edenberg, the trade capital of the world. Despite their average attributes, their fearless leadership is legendary throughout Vandamor. Humans are immune to fear, have a bonus to treasure, and the best pulling in the game.",Ogre:"Ogres hail from Gorgek, a city on an isolated peninsula of southern Vandamor. A brutish and violent race, Ogres have the highest strength and stamina among all races. Furthermore, they are immune to stuns which makes them powerful allies in any party.",Troll:"Trolls are a savage race from the swaps of Slagnon. Their strength and stamina is second only to Ogres. They uniquely regenerate health faster than any other race, but they are weak to fire magic.","Wood Elf":"Wood Elves are a race from the city of Artremia. Their knowledge of the great outdoors is unmatched, giving them strong cold resistance, fire resistance, and the best scouting skills among all races. They are also skilled at disarming traps."},job:{Bard:"Bards are a utility class that can wear plate armor. They can fill in almost any role in a pinch, but their true strength lies in making everyone in their party better. Their charm and crowd control skills make them a boon to any party. They also have very strong all-around dungeon skills.",Cleric:"Clerics are a healing class that can wear plate armor. They specialize in directly healing their allies in combat. They boast powerful support spells that buff their party's health and armor. They also have strong magic-based stuns and they can do modest magic damage in a pinch.",Druid:"Druids are a healing class that can wear leather armor. They have strong direct healing skills and HoT spells. Druids also have powerful elemental spells that make them highly adaptive. Their strong support spells and exception dungeon skills make them an asset to any party.",Enchanter:"Enchanters are a utility class that can only wear cloth armor. Among the cloth-wearing casters, their magic does the least amount of damage, but they have the strongest support spells in the game. Their ability to crowd control is unmatched, and they have the ability to charm mobs when you really need to turn the tables.",Magician:"Magicians are a magical DPS class that can only wear cloth armor. They boast the strongest pets in the game due to their ability to summon four types of pets. They also wield powerful elemental magic and some of the most useful support spells in the game.",Monk:"Monks are a physical DPS class that can wear leather armor. Monks practice martial arts to deliver powerful punches and kicks. Monks deliver top-tier physical DPS with hand-to-hand or blunt weapons. They have solid dungeon skills and the best pulling ability among all classes.",Necromancer:"Necromancers are a magical DPS class that can only wear cloth armor. They have powerful skeleton pets that make quick work of their enemies. Powerful DoT spells, fear, and life tap make them a formidable addition to any party.",Paladin:"Paladins are a tank class that can wear plate armor. Paladins have the unique ability to lay hands, healing themselves when they need it most. Paladins also have strong stuns and healing spells which make them very difficult to kill.",Ranger:"Rangers are a physical DPS class that can wear chain armor. They're the only class that can use bows, which help them inflict massive damage. A diverse arsenal of magic also aids them in battle. Notably, Rangers have the strongest overall dungeon skills, including the best scouting skills.",Rogue:"Rogues are a physical DPS class that can wear chain armor. Their combination of stealth and bursts of damage make them deadly on the battlefield. Rogues have unparalleled disarm trap skills, along with very strong treasure and scouting skills.",Shadowknight:"Shadowknights are a tank class that can wear plate armor. They have the unique ability to harm touch a mob, dealing a large amount of damage to a single target. They have the strongest offensive potential among all tanks along with deadly abilities like fear and life tap.",Shaman:"Shaman are a healing class that can wear chain armor. Their ability to buff their party and debuff mobs is capable of shifting the odds with ease. Their poison and frost spells make them both versatile and deadly in combat.",Warrior:"Warriors are a tank class that can wear plate armor. Warriors have the strongest physical defense and the highest hit points in the game. They can also dish out a solid amount of physical DPS. Their exceptional pulling skills help keep their party out of trouble.",Wizard:"Wizards are a magical DPS class that can only wear cloth armor. Instead of opting for trickery or pets, they focus on raw magical power. Wizards have a powerful and diverse arsenal of spells at their disposal that make quick work of their prey."}}[e][i]},getPossibleJobs:function(e){return L.possibleJobs[e]},getRaceAttrs:function(e){return L.raceAttrs[e]},getJobAttrs:function(e){return L.jobAttrs[e]},set:function(i,t){if(a.getElementById(i+"-value").innerHTML=L.form[i]=t,O.split("create-details",L.msg(i,t)),"job"===i&&(a.getElementById("type-value").innerHTML=L.types[t]),O.resists.forEach(function(e,i){a.getElementById(e+"-value").innerHTML=L.getResist(e)}),O.dungeon.forEach(function(e,i){a.getElementById(e+"-value").innerHTML=L.getDungeon(e)}),"gender"!==i&&L.form.race){var n=O.copy(L.getRaceAttrs(L.form.race)),o=O.copy(L.getJobAttrs(L.form.job));o.forEach(function(e,i){n[i]+=e}),e(".create-attr-value").removeClass("active"),O.attrs.forEach(function(e,i){var t=a.getElementById("create-points-"+e);t.innerHTML=L.form[e]=L.base[e]=n[i],o[i]&&(t.className=t.className+" active"),a.getElementById("create-points-remaining").innerHTML=L.form.left=10})}},getResist:function(e){var i=15,a=L.form;return"bleed"===e?("Female"===a.gender&&(i+=5),"Dark Elf"===a.race?i+=10:"Half Elf"===a.race&&(i+=3)):"poison"===e?("Female"===a.gender&&(i+=5),"Dwarf"===a.race?i+=10:"Half Elf"===a.race&&(i+=3)):"arcane"===e?("Male"===a.gender&&(i+=5),"Erudite"===a.race?i+=25:"Dark Elf"===a.race||"Dwarf"===a.race?i+=10:"Half Elf"===a.race&&(i+=3)):"lightning"===e?"Gnome"===a.race?i+=20:"Half Elf"===a.race&&(i+=3):"fire"===e?"Half Elf"===a.race?i+=3:"Troll"===a.race?i-=10:"Wood Elf"===a.race&&(i+=10):"cold"===e&&("Male"===a.gender&&(i+=5),"Barbarian"===a.race?i+=25:"Half Elf"===a.race?i+=3:"Wood Elf"===a.race&&(i+=10)),i},getDungeon:function(e){var i=15,a=L.form;return"traps"===e?("Dark Elf"===a.race?i+=5:"Halfling"===a.race||"Wood Elf"===a.race?i+=10:"Half Elf"===a.race&&(i+=7),"Shadowknight"===a.job||"Shaman"===a.job||"Wizard"===a.job||"Cleric"===a.job?i+=5:"Druid"===a.job||"Enchanter"===a.job||"Paladin"===a.job||"Warrior"===a.job?i+=10:"Monk"===a.job?i+=20:"Bard"===a.job||"Ranger"===a.job?i+=30:"Rogue"===a.job&&(i+=50)):"treasure"===e?("Gnome"===a.race?i+=5:"Dwarf"===a.race||"Human"===a.race?i+=10:"Halfling"===a.race?i+=20:"Half Elf"===a.race&&(i+=7),"Magician"===a.job||"Necromancer"===a.job||"Paladin"===a.job||"Shaman"===a.job?i+=5:"Enchanter"===a.job||"Monk"===a.job||"Warrior"===a.job||"Shadowknight"===a.job?i+=10:"Bard"===a.job||"Druid"===a.job?i+=20:"Rogue"!==a.job&&"Ranger"!==a.job||(i+=30)):"scout"===e?("Wood Elf"===a.race?i+=15:"Dark Elf"===a.race?i+=8:"Half Elf"===a.race?i+=7:"Barbarian"===a.race&&(i+=5),"Cleric"===a.job||"Shadowknight"===a.job||"Warrior"===a.job||"Wizard"===a.job?i+=5:"Enchanter"===a.job||"Paladin"===a.job||"Shaman"===a.job?i+=10:"Bard"===a.job||"Monk"===a.job?i+=20:"Rogue"===a.job||"Druid"===a.job?i+=25:"Ranger"===a.job&&(i+=50)):"pulling"===e&&("Human"===a.race?i+=20:"Halfling"===a.race?i+=10:"Half Elf"===a.race?i+=7:"Erudite"===a.race&&(i+=5),"Magician"===a.job||"Necromancer"===a.job||"Shaman"===a.job?i+=5:"Enchanter"===a.job||"Rogue"===a.job||"Shadowknight"===a.job||"Paladin"===a.job?i+=10:"Druid"===a.job?i+=15:"Bard"===a.job?i+=20:"Ranger"===a.job?i+=30:"Warrior"===a.job?i+=40:"Monk"===a.job&&(i+=50)),i},setRandomGender:function(){var a=e(".select-gender:eq("+~~(2*i.random())+")");a.length&&a.trigger(z.click)},setRandomRace:function(){var a=e(".select-race:eq("+~~(12*i.random())+")");a.length&&a.trigger(z.click)},setRandomClass:function(a){e(".select-class").removeClass().addClass("select-class disabled");var t="",n=L.getPossibleJobs(a),o=n.length;n.forEach(function(e,i){t+="#create-"+e,i<o-1&&(t+=", ")}),e(t).removeClass("disabled");var l=e(".select-class:not(.disabled)"),o=l.length;(l=l.eq(~~(i.random()*o))).length&&l.trigger(z.click)}},O={id:0,getId:function(){return O.id++,O.id>999999999&&(O.id=1),O.id},events:function(){e(C).focus(function(){}),e("body").on("dragstart","img",function(e){e.preventDefault()}),app.isLocal||(a.addEventListener("contextmenu",function(e){return N.hideCheck(),e.preventDefault(),!1},!1),C.addEventListener("wheel",function(e){e.ctrlKey&&e.preventDefault()},!1)),e("#enter-world").on(z.click,function(){Z.go()}),e(C).on("resize orientationchange focus",function(){w(O.resizeTimer),O.resizeTimer=v(function(){if(U.initialized&&U.scrollBottom(),"battle"===O.view)for(var e=0;e<Q.max;e++)Q.sizeMob(e)},50)}).on("load",function(){z.resizeWindow()})},disconnect:function(i){O.view="disconnected",e(a).add("*").off(),e("main > *").css("display","none");var n=a.getElementById("scene-error");n.style.display="block",n.innerHTML=i||"You have been disconnected from the server",v(function(){t.reload()},12e3)},resizeTimer:0,races:["Barbarian","Dark Elf","Dwarf","Erudite","Gnome","Half Elf","Halfling","High Elf","Human","Ogre","Troll","Wood Elf"],jobs:["Bard","Cleric","Druid","Enchanter","Magician","Monk","Necromancer","Paladin","Ranger","Rogue","Shadowknight","Shaman","Warrior","Wizard"],jobShort:{Bard:"BRD",Cleric:"CLR",Druid:"DRU",Enchanter:"ENC",Magician:"MAG",Monk:"MNK",Necromancer:"NEC",Paladin:"PLD",Ranger:"RNG",Rogue:"ROG",Shadowknight:"SHD",Shaman:"SHM",Warrior:"WAR",Wizard:"WIZ"},toJobShort:function(e){return O.jobShort[e]},jobLong:{BRD:"Bard",CLR:"Cleric",DRU:"Druid",ENC:"Enchanter",MAG:"Magician",MNK:"Monk",NEC:"Necromancer",PLD:"Paladin",RNG:"Ranger",ROG:"Rogue",SHD:"Shadowknight",SHM:"Shaman",WAR:"Warrior",WIZ:"Wizard"},toJobLong:function(e){return O.jobLong[e]},getJobShortKeys:function(){return E.keys(O.jobLong)},copy:function(e){return T.parse(T.stringify(e))},loadMsg:"<div class='text-shadow text-center now-loading'>Loading... <i class='fa fa-cog fa-spin load-cog'></i></div>",attrs:["str","sta","agi","dex","wis","intel","cha"],resists:["bleed","poison","arcane","lightning","fire","cold"],dungeon:["traps","treasure","scout","pulling"],gameDuration:0,delay:I.isMobile?0:.5,modalSpeed:I.isMobile?0:.5,friends:[],ignore:[],joinedGame:!1,searchingGame:!1,defaultTitle:"Nevergrind 2",titleFlashing:!1,name:"",password:"",view:"title",resizeX:1,resizeY:1,chatOn:!1,lastKey:0,lockOverlay:a.getElementById("lock-overlay"),startTime:M.now(),locked:0,loadAttempts:0,isModalOpen:!1,setScene:function(i){e(".scene").removeClass("none").css("display","none"),a.getElementById("scene-"+i).style.display="block",O.view=i},camel:function(e){for(var i=1,a=(e=e.split("-")).length;i<a;i++)e[i]=e[i].charAt(0).toUpperCase()+e[i].substr(1);return e.join("")},lock:function(e){O.lockOverlay.style.display="block",O.lockOverlay.style.opacity=e?0:1,O.locked=1},unlock:function(){O.lockOverlay.style.display="none",O.locked=0},unlockFade:function(e){e||(e=1),n.to(O.lockOverlay,e,{startAt:{opacity:1},ease:c.easeIn,opacity:0,onComplete:function(){O.lockOverlay.style.display="none"}})},updateUserInfo:function(){"localhost"!==t.hostname&&e.ajax({async:!0,type:"GET",dataType:"jsonp",url:"https://geoip-db.com/json/geoip.php?jsonp=?"}).done(function(i){i.latitude+="",i.longitude+="",O.geo=i,e.ajax({url:app.url+"php/updateUserInfo.php",data:{location:O.geo}}).done(function(){localStorage.setItem("geo",T.stringify(O.geo)),localStorage.setItem("geoSeason",1),localStorage.setItem("geoTime",M.now())})})},checkPlayerData:function(){var e=localStorage.getItem(Y.account+"_geo"),i=localStorage.getItem(Y.account+"_geoTime"),a=localStorage.getItem(Y.account+"_geoSeason");null!==i||null===a?(M.now()-i>7776e3||null===a)&&O.updateUserInfo():null===e&&O.updateUserInfo();var t=localStorage.getItem("ignore");if(null!==t)O.ignore=T.parse(t);else{localStorage.setItem("ignore",T.stringify([]))}},TDC:function(){return new n.delayedCall(0,"")},TM:function(e){return e=e||{},new o(e)},config:{audio:{musicVolume:10,soundVolume:50}},geo:{},keepAlive:function(){e.ajax({type:"GET",url:app.url+"php/keepAlive.php"}).always(function(){v(O.keepAlive,12e4)})},msg:function(e,i){P.msg.innerHTML=e,(i===j||i<2)&&(i=2),n.to(P.msg,i,{overwrite:1,startAt:{visibility:"visible",alpha:1},onComplete:function(){n.to(this.target,.2,{alpha:0,onComplete:function(){n.set(this.target,{visibility:"hidden"})}})}})},split:function(e,i,t){t===j&&(t=.01);if((e=a.getElementById(e)).innerHTML=i,I.isMobile);else if(null!==e){var o=new SplitText(e,{type:"words,chars"});n.staggerFromTo(o.chars,t,{immediateRender:!0,alpha:0},{delay:.1,alpha:1},.01)}},logout:function(){if(!O.locked){O.lock(),e.ajax({type:"GET",url:app.url+"php/deleteFromFwtitle.php"});try{FB.getLoginStatus(function(e){e.authResponse&&FB.logout(function(e){})})}catch(e){console.info("Facebook OAuth error: ",e)}try{gapi.auth2.getAuthInstance().signOut().then(function(){})}catch(e){console.info("Google OAuth error: ",e)}v(function(){e.ajax({type:"GET",url:app.url+"php/logout.php"}).done(function(e){O.msg("Logout successful"),localStorage.removeItem("email"),localStorage.removeItem("token"),t.reload()}).fail(function(){O.msg("Logout failed.")})},1e3)}},goCreateCharacter:function(){O.lock(1);var i="#scene-title-select-character",a=0,t=function(){2==++a&&(O.unlock(),n.set(i,{display:"none",opacity:1}),L.setRandomGender(),L.setRandomRace(),n.to("#scene-title-create-character",.6,{startAt:{display:"block",y:20,opacity:0},y:0,opacity:1,onComplete:function(){e("#create-character-name").focus(),O.unlock()}}))};n.to(i,.6,{y:20,opacity:0,onComplete:function(){t()}}),e.ajax({type:"GET",url:app.url+"php2/create/getStatMap.php"}).done(function(i){i=i.statMap;O.races.forEach(function(e){L.raceAttrs[e]=i[e].attrs,L.possibleJobs[e]=i[e].jobs}),O.jobs.forEach(function(e){L.jobAttrs[e]=i.jobs[e]}),e("#create-character-name").val(""),t()})},initGame:function(){e.ajax({type:"GET",url:app.url+"php2/init-game.php"}).done(function(i){console.info("init-game",i.account,i),console.info(i),app.initialized=1,i.account?(app.account=Y.account=i.account,a.getElementById("logout").textContent="Logout "+i.account,O.displayAllCharacters(i.characterData),O.checkPlayerData(),e("#login-modal").remove()):notLoggedIn(),a.getElementById("version").textContent="Version "+app.version;var n=t.hash;app.isLocal&&("#town"!==n&&"#battle"!==n&&"#dungeon"!==n||Z.go()),null===i.resetSession&&sessionStorage.clear()})},playerCardClicks:0,displayAllCharacters:function(i){var t="";i.forEach(function(e){t+='<div data-row="'+e.row+'" data-name="'+e.name+'" class="btn btn-lg ch-card center select-player-card"><div class="ch-card-name">'+e.name+'</div><div class="ch-card-details">'+e.level+" "+e.race+" "+O.toJobLong(e.job)+"</div></div>"}),a.getElementById("ch-card-list").innerHTML=t,e(".select-player-card:first").trigger(z.click)}};O.init=(e.ajaxSetup({type:"POST",timeout:5e3}),void(TweenLite.defaultEase=Quad.easeOut));var z={setMobile:function(){},click:I.isMobile?"mousedown":"click",context:I.isMobile?"mousedown":"click contextmenu",resizeTimer:0,resizeWindow:function(){N.isOpen&&N.hide()},isXbox:/Xbox/i.test(navigator.userAgent),isPlaystation:navigator.userAgent.toLowerCase().indexOf("playstation")>=0,isNintendo:/Nintendo/i.test(navigator.userAgent),isOpera:!!C.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox:"undefined"!=typeof InstallTrigger,isSafari:E.prototype.toString.call(C.HTMLElement).indexOf("Constructor")>0,isMSIE:!1,isMSIE11:!!navigator.userAgent.match(/Trident\/7\./)};z.isChrome=!!C.chrome&&!z.isOpera,function(){localStorage.getItem("isMobile");z.isMSIE||z.isMSIE11||z.isSafari,I.isMobile&&z.setMobile(),localStorage.setItem("isMobile",I.isMobile)}();var P,Y={mouse:{x:0,y:0},channel:"",lastReceivedWhisper:"",p_id:0,leader:"",isLeader:0,zoneMobs:[],party:[],guild:{id:0,rank:"",memberNumber:0,motd:"",members:0,name:""},guildChannel:function(){return"guild:"+Y.guild.id},getPartyNames:function(){var e=[];return Y.party.forEach(function(i){i.name&&e.push(i.name)}),e},isLowestPartyIdMine:function(){var e=Y.party[0].id;return Y.party.forEach(function(i){i.id&&i.id<e&&(e=i.id)}),e===Y.party[0].id},getNewLeaderName:function(){var e=Y.party[0].id,i=Y.party[0].name;return Y.party.forEach(function(a){a.id&&a.id<e&&(i=a.name)}),i},getPartyMemberIdByName:function(e){var i=0;return Y.party.forEach(function(a){a.name===e&&(i=a.id)}),i},getPartySlotByRow:function(e){var i=0;return Y.party.forEach(function(a,t){a.id===e&&(i=t)}),i},partyCount:function(){var e=0;return Y.party.forEach(function(i,a){i.name&&e++}),e},Party:function(){return{row:0,id:0,name:"",isLeader:0,job:"",level:0,hp:0,maxHp:0,mp:0,maxMp:0,heartbeat:M.now()}},resetClientPartyValues:function(e){Y.party[e].heartbeat=M.now(),Y.party[e].linkdead=0},team:0,slot:1,tgt:1,attackOn:!1,hudTimer:O.TDC(),hud:function(e,i){Y.hudTimer.kill(),DOM.hud.style.visibility="visible",DOM.hud.textContent=e,i&&(timer.hud=n.to(DOM.hud,5,{onComplete:function(){DOM.hud.style.visibility="hidden"}}))},clearHud:function(){Y.hudTimer.kill(),DOM.hud.style.visibility="hidden"},nextTarget:function(e){},exitGame:function(i){if("game"===O.view)var a=confirm("Are you sure you want to surrender?");(a||i||"game"!==O.view)&&(O.lock(1),e.ajax({url:app.url+"php/exitGame.php",data:{view:O.view}}).always(function(){t.reload()}))},selectedQuest:"",quest:{}};!function(e){P={body:e.getElementById("body"),bgmusic:e.getElementById("bgmusic"),msg:e.getElementById("msg"),chatInput:e.getElementById("chat-input"),chatLog:e.getElementById("chat-log")}}(a);var F={isOpen:0,overlay:a.getElementById("modal-overlay"),wrap:a.getElementById("modal-wrap"),show:function(i){F.isOpen=1,i.camelKey=O.camel(i.key);var a='<div class="stag-blue">'+F.header(i)+F.body(i)+(i.hideFooter?"":F.footer(i))+"</div>";F.wrap.innerHTML=a,F.isOpen=!0,n.to(F.overlay,.3,{startAt:{visibility:"visible",alpha:0},alpha:1}),n.to(F.wrap,.3,{startAt:{visibility:"visible",alpha:0,top:30},alpha:1,top:50}),e("#modal-dismiss, #modal-overlay").on(z.click,function(){F.hide()}),e("#modal-wrap").on(z.click,"#delete-character-confirm",function(){L.deleteCharacter()}),i.focus&&v(function(){e("#modal-wrap input:first").focus()},100)},hide:function(){n.to([F.overlay,F.wrap],.3,{overwrite:0,alpha:0,onComplete:function(){F.isOpen=0,O.unlock(),n.set(this.target,{visibility:"hidden"})}})},header:function(e){return{playerIdleBoot:'<div id="modal-header">Disconnected</div>',deleteCharacter:'<div id="modal-header">Delete '+L.name+"?</div>"}[e.camelKey]},body:function(e){return{playerIdleBoot:'<div id="modal-body"><p>You have been disconnected from the server.</p></div>',deleteCharacter:'<div id="modal-body"><p>Are you sure you want to delete this character?</p></div>'}[e.camelKey]},footer:function(e){return'<div id="modal-footer" class="text-center"><a id="modal-dismiss" class="ng-btn modal-buttons">Cancel</a><a id="'+e.key+'-confirm" class="ng-btn modal-buttons">Confirm</a></div>'}},R={events:function(){e("#bgmusic").on("ended",function(){var e=a.getElementById("bgmusic");e.currentTime=0,e.play()}),e("#bgamb1").on("ended",function(){var e=a.getElementById("bgamb1");e.currentTime=0,e.play()}),e("#bgamb2").on("ended",function(){var e=a.getElementById("bgamb2");e.currentTime=0,e.play()})},ext:function(e){return e.canPlayType&&e.canPlayType("audio/mpeg;").replace(/no/,"")?"mp3":"ogg"}(a.createElement("audio")),on:!!a.createElement("audio").canPlayType,play:function(e,i){if(e)if(i)O.config.audio.musicVolume&&(P.bgmusic.pause(),P.bgmusic.src="music/"+e+".mp3",P.bgmusic.volume=O.config.audio.musicVolume/100);else if(O.config.audio.soundVolume){var a=new Audio("sound/"+e+".mp3");a.volume=O.config.audio.soundVolume/100,a.play()}},save:function(){var e=T.stringify(O.config);localStorage.setItem("config",e)},setMusicVolume:function(e){O.config.audio.musicVolume?e||R.pause():R.musicStart(),P.bgmusic.volume=e/100,O.config.audio.musicVolume=e,R.save()},setSoundVolume:function(e){O.config.audio.soundVolume=e,R.save()},pause:function(){P.bgmusic.pause()},gameMusicInit:function(){O.config.audio.musicVolume&&(R.pause(),P.bgmusic.loop=!1,R.gameMusicPlayNext())},trackIndex:~~(8*i.random()),tracks:["ArcLight","Blackmoor Colossus","Blackmoor Tides","Dark Descent","Heroic Demise","Ireland's Coast","Salt Marsh Birds","Snowland Loop","soliliquoy","The Dark Amulet"],gameMusicPlayNext:function(){R.totalTracks=R.tracks.length;var e=R.tracks[++R.trackIndex%R.totalTracks];P.bgmusic.pause(),P.bgmusic.src="music/"+e+".mp3",P.bgmusic.volume=O.config.audio.musicVolume/100,P.bgmusic.onended=function(){R.gameMusicPlayNext()},console.info("PLAYING: ",e)},fade:function(){var e={vol:O.config.audio.musicVolume/100};n.to(e,2.5,{vol:0,ease:Linear.easeNone,onUpdate:function(){P.bgmusic.volume=e.vol}})},cache:{},load:{title:function(){for(var e=["bash"],i=0,a=e.length;i<a;i++){var t=e[i];R.cache[t]=new Audio("sound/"+t+".mp3")}},game:function(){for(var e=["bash"],i=0,a=e.length;i<a;i++){var t=e[i];R.cache[t]=new Audio("sound/"+t+".mp3")}}},musicStart:function(){"game"!==O.view||R.gameMusicPlayNext()}};R.init=function(){var i=localStorage.getItem("config");if(null===i)R.save();else{var a=T.parse(i);O.config.audio.musicOn===j&&(O.config.audio=a.audio)}R.load.title(),O.config.audio.musicVolume?R.musicStart():R.pause();var t=!1,n=e("#musicSlider");n.length&&n.slider({min:0,max:100,value:O.config.audio.musicVolume,formatter:function(e){return t?(R.setMusicVolume(e),e):O.config.audio.musicVolume}}).slider("setValue",O.config.audio.musicVolume);(n=e("#musicSlider")).length&&e("#soundSlider").slider({min:0,max:100,value:O.config.audio.soundVolume,tooltip_position:"bottom",formatter:function(e){return t?(R.setSoundVolume(e),e):O.config.audio.soundVolume}}).on("slideStop",function(e){R.play("machine0")}).slider("setValue",O.config.audio.soundVolume),t=!0}();var q={maxPlayers:6,init:0,session:{timer:0},questDelay:3e3,ping:{start:M.now(),oneWay:function(){return~~((M.now()-q.ping.start)/2)},roundTrip:function(){return M.now()-q.ping.start}},pingColors:["","chat-warning","chat-alert"],pingColor:function(e){var i;return i=e<150?0:e<350?1:2,q.pingColors[i]},start:function(){q.init||(q.init=1,w(q.session.timer),q.updateChatRoom.start(),q.heartbeat.start(),q.socket.start(),q.played.start(),q.sanity.party.start(),q.sanity.chat.start())},updateChatRoom:{start:function(){b(U.updateChannel,15e3)}},heartbeat:{enabled:1,timer:0,success:0,fails:0,successiveFails:0,attempts:0,start:function(){q.ping.start=M.now(),e.ajax({type:"GET",url:app.url+"php2/heartbeat-first.php"}).done(function(e){e.name=Y.name,q.heartbeat.timer=v(q.heartbeat.send,5e3),K.updateBars(e)})},send:function(){console.info("%c Last heartbeat interval: ","background: #ff0",M.now()-q.ping.start+"ms"),q.ping.start=M.now(),w(q.heartbeat.timer),q.heartbeat.enabled?e.ajax({type:"GET",url:app.url+"php2/heartbeat.php"}).done(function(e){q.heartbeat.success++,q.heartbeat.successiveFails&&q.resync(),q.heartbeat.successiveFails=0,console.info("heartbeat data: ",e),e.name=Y.name,K.updateBars(e)}).fail(function(e){q.heartbeat.callbackFail(e)}).always(function(){q.heartbeat.timer=v(q.heartbeat.send,5e3),q.heartbeat.attempts++;var e=q.ping.oneWay();console.info("%c Ping: ","background: #0f0",e+"ms","Ratio: "+q.heartbeat.success/q.heartbeat.attempts*100+"%"),K.dom.ping.innerHTML='<span class="'+q.pingColor(e)+'">'+e+"ms</span>"}):q.heartbeat.callbackFail({responseText:"You failed to find your way back to town."})},callbackFail:function(e){console.info("%c heartbeatCallback","background: #f00",e.responseText),q.heartbeat.fails++,q.heartbeat.successiveFails++,q.heartbeat.successiveFails>1&&O.disconnect(e.responseText)}},socket:{timer:0,checkTimer:0,sendTime:0,receiveTime:0,interval:5e3,expired:16e3,start:function(){v(function(){n.to("#bar-lag",.5,{opacity:1})},q.socket.interval),q.socket.sendTime=M.now(),q.socket.receiveTime=M.now(),k(q.socket.checkTimer),q.socket.checkTimer=b(q.socket.checkTimeout,q.socket.interval),k(q.socket.timer),q.socket.timer=b(q.socket.send,q.socket.interval)},send:function(){q.socket.sendTime=M.now(),V.zmq.publish("hb:"+Y.name,{})},checkTimeout:function(){var e=M.now()-q.socket.receiveTime;console.info("%c Socket ping: ","background: #08f",e+"ms"),e>q.socket.expired&&O.disconnect()},heartbeatCallback:function(){q.socket.receiveTime=M.now();var e=q.socket.receiveTime-q.socket.sendTime;K.dom.socket.innerHTML='<span class="'+q.pingColor(e)+'">'+e+"ms</span>"}},played:{timer:0,start:function(){k(q.played.timer),q.played.timer=b(q.played.send,6e4)},send:function(){e.ajax({type:"GET",url:app.url+"php2/update-played.php"}).always(function(){!app.isLocal&&console.clear()})}},sanity:{party:{timer:0,start:function(){k(q.sanity.party.timer),q.sanity.party.timer=b(function(){Y.p_id&&(q.sanity.party.send(),q.sanity.party.check())},5e3)},send:function(){console.info("Sending party heartbeats....");try{V.zmq.publish("party:"+Y.p_id,{id:Y.row,route:"party->hb"})}catch(e){console.info("sanity.party.send",e)}},check:function(){for(var e=M.now(),i=[],a=1;a<6;a++)console.info("Checking: ",Y.party[a].id,e-Y.party[a].heartbeat>2*q.socket.interval),Y.party[a].id&&!Y.party[a].linkdead&&e-Y.party[a].heartbeat>2*q.socket.interval&&(i.push(Y.party[a].name),Y.party[a].linkdead=1);i.forEach(function(e){V.zmq.publish("party:"+Y.p_id,{name:e,route:"party->linkdead"})})}},chat:{timer:0,start:function(){k(q.sanity.chat.timer),q.sanity.chat.timer=b(q.sanity.chat.send,6e4)},send:function(){"town"===O.view&&e.ajax({type:"GET",url:app.url+"php2/chat/sanity-chat.php"}).done(function(i){for(var a=0,t=i.players.length;a<t;a++)i.players[a]*=1;var n=[];U.inChannel.forEach(function(a){~i.players.indexOf(a)?n.push(a):e("#chat-player-"+a).remove()}),n.length&&(U.inChannel=n,U.setHeader())})}}},exit:function(){V.enabled&&(U.broadcast.remove(),Y.p_id,V.zmq.publish("friend:"+Y.name,{name:Y.name,route:"off"}),V.zmq.close())},resync:function(){},getGameState:function(){},scenes:["scene-town","scene-dungeon","scene-battle"],emptyScenesExcept:function(e){q.scenes.forEach(function(i){i===e?a.getElementById(i).style.opacity=0:a.getElementById(i).innerHTML=""})},getPetName:function(){var e=["Jo","Ge","Go","Gi","Ja","Jo","Je","Ji","Ka","Ke","Ko","Ki","La","Le","Lo","Li","Va","Ve","Vo","Xa","Xe","Xo","Za","Ze","Zo","Bo"],a=["bek","ban","bar","bek","bob","rek","rar","nar","ran","sar","sek","sob","n","s","k","n"],t=["er","tik","n","er","ab",""];return e[~~(i.random()*e.length)]+a[~~(i.random()*a.length)]+t[~~(i.random()*t.length)]}},G={init:void e(a).ready(function(){v(function(){O.initGame(),q.session.timer=v(function(){O.keepAlive()},18e4);var e=z.click;O.events(e),L.events(e),R.events()},100)}),test:function(){}},N={timer:0,openDate:0,isInside:0,isOpen:0,init:function(){var i=e("#tooltip-social-wrap");i.on(z.click,".context-items",function(i){console.info("context-items clicked: ",e(this).attr("id")),N.click(e(this).attr("id"))}),i.on("mouseenter",function(){N.isInside=1}).on("mouseleave",function(){N.isInside=0,w(N.timer),v(function(){N.isInside},1e3)})}(),click:function(e){console.info("click!",e,N.player),N.action[O.camel(e)](),N.hide()},action:{contextWhisper:function(){U.dom.chatInput.value="",U.mode.change({msg:"",mode:"@",name:N.player}),U.dom.chatInput.focus()},contextInvite:function(){U.sendMsg("/invite "+N.player)},contextRemoveFriend:function(){U.sendMsg("/friend remove "+N.player)},contextAddFriend:function(){U.sendMsg("/friend add "+N.player)},contextRemoveIgnore:function(){U.sendMsg("/ignore remove "+N.player)},contextAddIgnore:function(){U.sendMsg("/ignore add "+N.player)},contextDisband:function(){U.sendMsg("/disband")},contextPromote:function(){U.sendMsg("/promote "+N.player)},contextBoot:function(){U.sendMsg("/boot "+N.player)}},player:"",setPartyMenuHtml:function(){if(N.player){console.info("setPartyMenuHtml",N.player);var e=' class="context-items"',i="";N.player===Y.name?Y.p_id&&(i+='<div id="context-disband" '+e+">Disband</div>"):(Y.party[0].isLeader&&(i+='<div id="context-boot" '+e+">Boot</div>",i+='<div id="context-promote" '+e+">Promote</div>"),i+='<div id="context-whisper" '+e+">Whisper</div>",~O.friends.indexOf(N.player)?i+='<div id="context-remove-friend" '+e+">Unfriend</div>":i+='<div id="context-add-friend" '+e+">Friend</div>",~O.ignore.indexOf(N.player)?i+='<div id="context-remove-ignore" '+e+">Unignore</div>":i+='<div id="context-add-ignore" '+e+">Ignore</div>"),i&&N.show(i)}},setChatMenuHtml:function(){if(N.player&&N.player!==Y.name){var e=' class="context-items"',i="";~Y.getPartyNames().indexOf(N.player)||(i+='<div id="context-invite" '+e+">Invite</div>"),i+='<div id="context-whisper" '+e+">Whisper</div>",~O.friends.indexOf(N.player)?i+='<div id="context-remove-friend" '+e+">Unfriend</div>":i+='<div id="context-add-friend" '+e+">Friend</div>",~O.ignore.indexOf(N.player)?i+='<div id="context-remove-ignore" '+e+">Unignore</div>":i+='<div id="context-add-ignore" '+e+">Ignore</div>",N.show(i)}},position:{padding:10,halfWidth:~~(e("#tooltip-social-wrap").width()/2),x:function(){if(Y.mouse.x<N.position.halfWidth)Y.mouse.x+=N.position.halfWidth/2,Y.mouse.x<80&&(Y.mouse.x=80);else if(Y.mouse.x>C.innerWidth-N.position.halfWidth){Y.mouse.x-=N.position.halfWidth/2;var e=C.innerWidth-80;Y.mouse.x>e&&(Y.mouse.x=e)}return Y.mouse.x},y:function(){var i=Y.mouse.y<C.innerHeight/2?15:-1*(15+~~e("#tooltip-social-wrap").height());return Y.mouse.y+i}},show:function(e){if(e){var i=a.getElementById("tooltip-social-wrap");i.innerHTML=e,i.style.top=N.position.y()+"px",i.style.left=N.position.x()+"px",i.style.visibility="visible",N.isOpen=1,N.openDate=M.now()}},hide:function(){a.getElementById("tooltip-social-wrap").style.visibility="hidden",N.isOpen=0},hideCheck:function(){N.isOpen&&M.now()-N.openDate>100&&!N.isInside&&N.hide()},getChatMenu:function(e){N.player=e,N.setChatMenuHtml()},getPartyMenu:function(e){N.player=e,N.setPartyMenuHtml()}};onbeforeunload=function(){q.exit()},e(a).on(z.click,function(e){return N.hideCheck(),e.preventDefault(),!1}).on("keydown",function(i){var a=i.keyCode,t=i.key;if(O.lastKey=t,app.isLocal&&console.info("keydown: ",t,a),app.isLocal)U.hasFocus||"title"===O.view||("b"===t?_.go():"t"===t?Z.go():"d"===t&&ae.go());else if(a>=112&&a<=121||123===a)return!1;if(i.altKey)return!1;if(i.ctrlKey){if(82===a)return U.reply(),!1;U.hasFocus||X.hasFocus||65!==a&&70!==a||i.preventDefault()}else{if(!U.hasFocus&&!X.hasFocus&&191===a){return void(!e("#chat-input").val()&&e("#chat-input").focus())}if("title"===O.view)O.isModalOpen||I.isMobile||e("#create-character-name").focus();else{if(U.hasFocus){if(U.mode.change())return!1;if(38===a){if(U.history[U.historyIndex-1]!==j){n=U.history[--U.historyIndex];U.dom.chatInput.value=n.msg,U.mode.change(n)}}else if(40===a){if(U.history.length===U.historyIndex+1)U.historyIndex++,U.clear();else if(U.history[U.historyIndex+1]!==j){var n=U.history[++U.historyIndex];U.dom.chatInput.value=n.msg,U.mode.change(n)}}else 13===a&&Y.name&&U.sendMsg()}"town"===O.view?U.hasFocus||(!Z.aside.selected&&U.dom.chatInput.focus(),X.hasFocus&&13===a&&X.create()):((!U.hasFocus&&13===a||191===a)&&U.dom.chatInput.focus(),9===a?(i.shiftKey?Y.nextTarget(!0):Y.nextTarget(!1),i.preventDefault()):86===a&&("game"!==O.view||O.chatOn||q.toggleGameWindows(1)))}}}),e(C).on("mousemove",function(e){Y.mouse.x=e.clientX,Y.mouse.y=e.clientY}).on("resize",function(){N.hide(),w(N.resizeTimer),N.resizeTimer=v(function(){},100)});var V={unsubscribe:function(e){try{V.zmq.unsubscribe(e)}catch(e){console.info(e)}},joinGame:function(){!function e(){V.enabled?(V.unsubscribe("title:"+Y.channel),V.unsubscribe("game:"+q.id),console.info("Subscribing to game:"+q.id),V.zmq.subscribe("game:"+q.id,function(e,i){-1===O.ignore.indexOf(i.account)&&G.chatReceive(i)})):v(e,100)}()},initWhisper:function(){if(V.enabled){var i="hb:"+Y.name;console.info("subscribing to heartbeat channel: ",i),V.zmq.subscribe(i,function(){q.socket.heartbeatCallback()}),i="name:"+Y.name,console.info("subscribing to whisper channel: ",i),V.zmq.subscribe(i,function(i,a){"party"===a.routeTo?ee.party(a,a.route):"send"===a.action?(console.info("Sent whisper: ",a),ee.town(a,a.route),U.lastWhisper.name=a.name,e.ajax({url:app.url+"php2/chat/send.php",data:{action:"receive",msg:U.whisper.parse(a.msg),class:"chat-whisper",category:"name:"+a.name}})):"receive"===a.action?(U.lastWhisper.name||(U.lastWhisper={name:a.name}),a.msg=U.whisper.to(a)+U.whisper.parse(a.msg),ee.town(a,"chat->log")):"guild-invite"===a.action?(console.info("guild invite received! ",a),U.prompt.add(a)):"party-invite"===a.action?(console.info("party invite received! ",a),U.prompt.add(a)):"party-invite-deny"===a.action?U.log(a.name+" has denied your party invite.","chat-warning"):"guild-invite-deny"===a.action?U.log(a.name+" has denied your guild invite.","chat-warning"):"party-accept"===a.action?U.log(a.name+" has joined the party.","chat-warning"):"friend>addedMe"===a.route&&U.log(a.name+" has added you to their friend list.","chat-warning")})}},enabled:0,init:function(e){V.zmq=new ab.Session("wss://"+app.socketUrl+"/wss2/",function(){V.connectionSuccess()},function(e,i){console.info("Websocket connection closed. Code: "+e+"; reason: "+i),console.debug("WebSocket connection failed. Retrying..."),V.enabled=0,v(V.init,100)},{skipSubprotocolCheck:!0})},initialConnection:1,routeMainChat:function(e,i){ee.town(i,i.route)},connectionSuccess:function(){if(V.enabled=1,console.info("Socket connection established with server"),V.initialConnection){V.initialConnection=0;console.info("subscribing to channel: ","admin:broadcast"),V.zmq.subscribe("admin:broadcast",function(e,i){console.info("rx ",e,i),ee.town(i,i.route)}),function e(){Y.name?(V.initWhisper(),V.initFriendAlerts(),V.initGuild()):v(e,200)}(),U.broadcast.add(),U.setHeader(),V.zmq.publish("friend:"+Y.name,{name:Y.name,route:"on"})}},initFriendAlerts:function(){O.friends.forEach(function(e){V.unsubscribe("friend:"+e),V.zmq.subscribe("friend:"+e,function(e,i){U.friend.notify(e,i)})})},initParty:function(e){V.unsubscribe("party:"+Y.p_id);var i="party:"+e;Y.p_id=e,console.info("subscribing to channel: ",i);try{V.zmq.subscribe(i,function(e,i){"chat->log"===i.route?ee.town(i,i.route):ee.party(i,i.route)})}catch(e){console.info("socket.initParty ",e)}},initGuild:function(){Y.guild.id&&(console.info("subscribing to guild channel: ",Y.guildChannel()),Y.guild.motd&&U.log("Guild Message of the day: "+Y.guild.motd,"chat-guild"),V.zmq.subscribe(Y.guildChannel(),function(e,i){console.info("rx ",e,i),"chat->log"===i.route?ee.town(i,i.route):ee.guild(i,i.route)}))}},U={prefix:"ng2:",default:"town",getChannel:function(){return U.prefix+Y.channel},html:function(){return'<div id="chat-present-wrap" class="no-select"><div id="chat-header">&nbsp;</div><div id="chat-room"></div></div><div id="chat-log-wrap"><div id="chat-log"><div>Welcome to Vandamor.</div><div class="chat-warning">Nevergrind 2 is still in development, but feel free to test it out!</div><div class="chat-emote">Type /help or /h for a list of chat commands.</div></div><div id="chat-prompt" class="no-select"></div><div id="chat-input-wrap"><div id="chat-input-mode" class="chat-white no-select"><span id="chat-mode-msg" class="ellipsis">To town:</span></div><input id="chat-input" type="text" maxlength="240" autocomplete="off" spellcheck="false" /></div></div>'},initialized:0,isClicked:!1,hasFocus:!1,count:1,players:[],lastWhisper:{name:""},mode:{types:["/say","/party","/guild"],command:"/say",name:"",change:function(i){var a=i===j?U.dom.chatInput.value+O.lastKey:i.mode;if("/say"===(a=a.replace(/^\s+/g,""))&&!Y.channel)return U.log("You cannot communicate in town while in a dungeon","chat-warning"),v(function(){e("#chat-input").val("")}),!1;if(U.mode.types.indexOf(a)>-1)return U.mode.command=a,U.mode.set(a),i||(U.dom.chatInput.value=""),!0;if("@"===(i&&a[0])||!i&&"@"===a[0]&&" "===O.lastKey){if(i)t=i.name;else{var t=U.parseMsg(a).first.substr(1);t=(t=t.toLowerCase())[0].toUpperCase()+t.substr(1)}return U.mode.command="@",U.mode.name=t,U.mode.set(U.mode.command),i||(U.dom.chatInput.value=""),!0}return!1},set:function(e){"/say"===e?(U.dom.chatInputMode.className="chat-white",U.dom.chatModeMsg.textContent="To "+Y.channel+":"):"/party"===e?(U.dom.chatInputMode.className="chat-party",U.dom.chatModeMsg.textContent="To party:"):"/guild"===e?(U.dom.chatInputMode.className="chat-guild",U.dom.chatModeMsg.textContent="To guild:"):"@"===e&&(U.dom.chatInputMode.className="chat-whisper",U.dom.chatModeMsg.textContent="To "+U.mode.name+":")}},dom:{},init:function(){if(U.initialized)U.clearChatLog();else{var i=a.getElementById("chat-wrap");i.innerHTML="",i.style.display="flex",i.innerHTML=U.html(),U.initialized=1,e("#chat-log").on("mousedown",function(){U.isClicked=1}).on("mouseup",function(){U.isClicked=0}),e("#chat-input").on("focus",function(){U.hasFocus=1}).on("blur",function(){U.hasFocus=0}),e("#chat-prompt").on(z.click,".chat-prompt-yes",function(i){U.prompt.confirm(e(this).data())}).on(z.click,".chat-prompt-no",function(i){U.prompt.deny(e(this).data())}),e("#chat-room").on(z.context,".chat-player",function(){e(this).parent().attr("id").split("-");var i=e(this).text().split(":")[1].replace(/\]/g,"").trim();N.getChatMenu(i)}),U.dom.chatRoom=a.getElementById("chat-room"),U.dom.chatHeader=a.getElementById("chat-header"),U.dom.chatLog=a.getElementById("chat-log"),U.dom.chatInput=a.getElementById("chat-input"),U.dom.chatInputMode=a.getElementById("chat-input-mode"),U.dom.chatModeMsg=a.getElementById("chat-mode-msg"),U.dom.chatPrompt=a.getElementById("chat-prompt")}},log:function(e,i){if(e){for(;U.dom.chatLog.childElementCount>=500;)U.dom.chatLog.removeChild(U.dom.chatLog.firstChild);var t=a.createElement("div");i&&(t.className=i),t.innerHTML=e,U.dom.chatLog.appendChild(t),U.scrollBottom()}},historyIndex:0,history:[],updateHistory:function(e){var i={msg:e,mode:U.mode.command};"@"===U.mode.command&&(i.name=U.mode.name),U.history.push(i),U.historyIndex=U.history.length},divider:'<div class="chat-emote">========================================</div>',help:function(){for(var e='class="chat-emote"',i='class="chat-help-header"',a=[U.divider,"<div "+i+">Main Chat Channels:</div>","<div "+e+">/say : Say a message in your current chat channel : /say hail</div>","<div "+e+">/party : Message your party : /party hail</div>","<div "+e+">/guild : Message your guild : /guild hail</div>","<div "+e+">@ : Send a private message by name : @bob hi</div>","<div "+i+">Guild Commands</div>","<div "+e+">/ginvite: Invite a player to your guild: /ginvite Bob</div>","<div "+e+">/gpromote: Promote a guild member to Officer: /gpromote Bob</div>","<div "+e+">/gleader: Promote a guild member to Leader: /gleader Bob</div>","<div "+e+">/gboot: Boot a member from the guild: /gboot Bob</div>","<div "+e+">/motd: Set a new message of the day for your guild: /motd message</div>","<div "+e+">/gquit: Leave your guild: /gquit</div>","<div "+e+">/ginvite: Invite a player to your guild: /ginvite Bob</div>","<div "+e+">/ginvite: Invite a player to your guild: /ginvite Bob</div>","<div "+i+">Party Commands</div>","<div "+e+">/invite: Invite a player to your party : /invite Bob</div>","<div "+e+">/disband: Leave your party</div>","<div "+e+">/promote: Promote a player in your party to leader : /promote Bob</div>","<div "+e+">/boot: Boot a player from the party: /boot Bob</div>","<div "+i+">Social Commands:</div>","<div "+e+">/flist or /friends : Show your friends' online status</div>","<div "+e+">/friend add : Add a friend : /friend add Bob</div>","<div "+e+">/friend remove : Remove a friend : /friend remove Bob</div>","<div "+e+">/ignore : Show your ignore list</div>","<div "+e+">/ignore add : Add someone to your ignore list</div>","<div "+e+">/ignore remove : Remove someone from your ignore list</div>","<div "+e+">/who : Show all players currently playing</div>","<div "+e+">/who class : Show current players by class : /who warrior</div>","<div "+i+">Miscellaneous Commands:</div>","<div "+e+">/join channel : Join a channel : /join bros</div>","<div "+e+">/clear: clear the chat log</div>","<div "+e+">/played: Show character creation, session duration, and total playtime</div>","<div "+e+">/me : Send an emote to your current chat channel : /me waves</div>","<div "+e+">/camp: Exit the game.</div>"],t=0,n=a.length;t<n;t++)U.log(a[t])},sendMsg:function(i){var a=i||U.dom.chatInput.value.trim(),t=a.toLowerCase();if("?"===a||"/h"===a||"/help"===a)U.updateHistory(a),U.help();else if(0===t.indexOf("/motd"))X.motd(X.motdParse(a));else if(0===t.indexOf("/gleader"))X.leader(U.party.parse(a));else if(0===t.indexOf("/gpromote"))X.promote(U.party.parse(a));else if(0===t.indexOf("/gboot"))X.boot(U.party.parse(a));else if("/gquit"===t)X.quit();else if(0===t.indexOf("/ginvite"))X.invite(U.party.parse(a));else if(0===t.indexOf("/promote"))U.promote(U.party.parse(a));else if(0===t.indexOf("/boot"))U.boot(U.party.parse(a));else if("/disband"===t)U.disband();else if(0===t.indexOf("/invite"))U.invite(U.party.parse(a));else if("/camp"===t)U.camp();else if("/played"===t)U.played();else if(0===t.indexOf("/join"))U.join.channel(U.join.parse(a));else if("/clear"===t)U.clearChatLog();else if("/who"===t)U.who.all();else if(0===t.indexOf("/who ")&&t.length>5)U.who.class(U.who.parse(a));else if("/ignore"===t)U.ignore.list();else if(0===t.indexOf("/ignore remove"))U.ignore.remove(U.friend.parse(a));else if(0===t.indexOf("/ignore add"))U.ignore.add(U.friend.parse(a));else if("/friends"===t||"/flist"===t)U.friend.list();else if(0===t.indexOf("/friend remove"))U.friend.remove(U.friend.parse(a));else if(0===t.indexOf("/friend add"))U.friend.add(U.friend.parse(a));else if(0===t.indexOf("/me")||0===t.indexOf("/em"))U.emote(a);else if("@"===U.mode.command)Y.name!==U.mode.name&&(~O.ignore.indexOf(U.mode.name)&&U.log("You sent "+U.mode.name+" a whisper, but you are currently ignoring him.","chat-warning"),e.ajax({url:app.url+"php2/chat/send.php",data:{action:"send",msg:a,class:"chat-whisper",category:"name:"+U.mode.name}}));else if(a){var n=U.getMsgObject(a);"/"!==n.msg[0]&&(console.info(n),Y.p_id||0!==n.category.indexOf("party")?Y.guild.id||0!==n.category.indexOf("guild")?"ng2:"===n.category?U.log("You cannot communicate in town while in a dungeon","chat-warning"):e.ajax({url:app.url+"php2/chat/send.php",data:{msg:n.msg,class:n.class,category:n.category}}):U.log("You are not in a guild.","chat-warning"):U.log("You are not in a party.","chat-warning"))}U.updateHistory(a),U.clear()},parseMsg:function(e){var i=e.replace(/ +/g," ").split(" "),a={first:i[0].trim().toLowerCase()};return i.shift(),a.command=i.join(" "),a},getMsgObject:function(e){var i={category:U.getChannel(),msg:e,class:"chat-normal"},a=U.parseMsg(e),t=e.split(" ");t.shift();var n=t.join(" ");return"/s"===a.first?(i.category=U.getChannel(),i.msg=n,i.class="chat-normal"):"/p"===a.first?(i.category="party:"+Y.p_id,i.msg=n,i.class="chat-party"):"/party"===U.mode.command?(i.category="party:"+Y.p_id,i.msg=e,i.class="chat-party"):"/g"===a.first?(i.category="guild:"+Y.guild.id,i.msg=n,i.class="chat-guild"):"/guild"===U.mode.command?(i.category="guild:"+Y.guild.id,i.msg=e,i.class="chat-guild"):"/broadcast"===a.first&&(i.category="admin:broadcast",i.msg=a.command,i.class="chat-broadcast"),i},whispers:{},clear:function(){U.dom.chatInput.value=""},clearChatLog:function(){U.dom.chatLog.innerHTML=""},emote:function(i){var a=i.split(" ");a.shift(),"/"!==(i=a.join(" "))[0]&&e.ajax({url:app.url+"php2/chat/send.php",data:{msg:i,class:"chat-emote",category:U.getChannel()}})},ignore:{init:function(){O.ignore=T.parse(localStorage.getItem("ignore"))||O.ignore},list:function(){if(O.ignore.length){var e=U.divider+'<div class="chat-warning">Checking ignore list...</div>';O.ignore.forEach(function(i){e+='<div class="chat-emote">'+i+"</div>"}),U.log(e)}else U.log("Nobody is on your friends list yet.","chat-warning")},add:function(e){e!==Y.name&&(O.ignore.push(e),localStorage.setItem("ignore",T.stringify(O.ignore)),U.log("You have added "+e+" to your ignore list.","chat-warning"))},remove:function(e){for(;O.ignore.indexOf(e)>-1;){var i=O.ignore.indexOf(e);O.ignore.splice(i,1)}localStorage.setItem("ignore",T.stringify(O.ignore)),U.log("You have removed "+e+" from your ignore list.","chat-warning")}},promote:function(i,a){console.info("/promote ",i,a);var t=Y.getPartyMemberIdByName(i);(Y.party[0].isLeader||a)&&Y.p_id&&t&&e.ajax({url:app.url+"php2/chat/promote.php",data:{name:i,leaderId:t}}).done(function(e){}).fail(function(e){U.log(e.responseText,"chat-warning")})},disband:function(){if("battle"===O.view)U.log("You cannot disband the party during battle!","chat-warning");else{var i=Y.partyCount();e.ajax({type:"POST",url:app.url+"php2/chat/disband.php",data:{count:i}}).done(function(e){Y.p_id&&Y.quest.level&&O.msg("Mission abandoned: "+Y.quest.title),ie.initQuest(),K.disband(),ie.abort()}).fail(function(e){U.log(e.responseText,"chat-warning")}).always(function(){O.unlock()})}},boot:function(i,a){console.info("/promote ",i,a);var t=Y.getPartyMemberIdByName(i);(Y.party[0].isLeader||a)&&Y.p_id&&t&&e.ajax({url:app.url+"php2/chat/boot.php",data:{name:i,id:t}}).done(function(e){console.info("boot ",e)}).fail(function(e){U.log(e.responseText,"chat-warning")})},invite:function(i){Y.name===i?U.log("You can't invite yourself to a party.","chat-warning"):Y.p_id&&!Y.party[0].isLeader?U.log("Only the party leader may send invites.","chat-warning"):Y.quest.level?U.log("You cannot invite adventurers to the party after starting the mission.","chat-warning"):Y.channel?i?(U.log("Sent party invite to "+i+".","chat-warning"),e.ajax({url:app.url+"php2/chat/invite.php",data:{player:i}}).done(function(e){console.info("invite ",e),e.newParty&&(Y.party[0].isLeader=1,K.updatePlayerBar(0)),V.initParty(e.p_id)}).fail(function(e){U.log(e.responseText,"chat-warning")})):U.log("Syntax: /invite [player_name]","chat-warning"):U.log("You cannot invite adventurers from the depths of a dungeon.","chat-warning")},camp:function(){"town"!==O.view?U.log("You can only camp in town!","chat-warning"):(U.log("Camping...","chat-warning"),q.exit(),Y.p_id&&(Y.party[0].isLeader&&ne.promotePlayer(),U.sendMsg("/disband")),function i(a){Y.p_id?a<30?v(i,100,++a):U.log("Failed to camp successfully.","chat-warning"):v(function(){e.ajax({type:"GET",url:app.url+"php2/chat/camp.php"}).done(function(){t.reload()}).fail(function(){U.log("Failed to camp successfully.","chat-alert")})},500)}(0))},reply:function(){if(console.info("chat.lastWhisper.name",U.lastWhisper.name),U.lastWhisper.name){var e={mode:"@",name:U.lastWhisper.name};U.mode.change(e),U.dom.chatInput.focus()}},prompt:{add:function(i){var t="",n=a.createElement("div"),o=O.getId();console.info("prompt.add",i),n.id=i.action+"-"+i.row,n.className="prompt-row prompt-row-"+o+" "+i.css,t+='<div class="chat-prompt-msg stag-blue">'+i.msg+'</div><div class="chat-prompt-options stag-blue"><span data-row="'+i.row+'" data-id="'+o+'" data-action="'+i.action+'" data-c-id="'+i.cId+'" data-guild-name="'+i.guildName+'" class="chat-prompt-btn chat-prompt-yes"><i class="fa fa-check chat-prompt-yes-icon"></i>&thinsp;Confirm</span><span data-row="'+i.row+'" data-id="'+o+'" data-name="'+i.name+'"data-action="'+i.action+'" class="chat-prompt-btn chat-prompt-no"><i class="fa fa-times chat-prompt-no-icon"></i>&thinsp;Deny</span></div>',n.innerHTML=t,e("#"+i.action+"-"+i.row).remove(),U.dom.chatPrompt.appendChild(n),v(function(){e("#"+n.id).remove()},3e4),U.log(i.msg,"chat-warning")},confirm:function(i){e("#"+i.action+"-"+i.row).remove(),console.info("Prompt confirmed: ",i.action,i.row,i),"party-invite"===i.action?U.party.join(i):"guild-invite"===i.action&&X.join(i)},deny:function(i){console.info("deny ",i),e("#"+i.action+"-"+i.row).remove(),V.zmq.publish("name:"+i.name,{action:i.action+"-deny",name:Y.name})}},party:{join:function(i){console.info("party.join: ",i),e.ajax({url:app.url+"php2/chat/party-join.php",data:{row:i.row,cId:i.cId}}).done(function(e){console.info("party-join.php ",e),U.log("You have joined the party.","chat-warning"),V.initParty(i.row),K.getParty()}).fail(function(e){console.info("Oh no",e),U.log(e.responseText,"chat-warning")})},parse:function(e){var i=e.replace(/ +/g," ").split(" ");return i[1]===j?"":(i[1][0].toUpperCase()+i[1].substr(1).toLowerCase()).trim()}},whisper:{parse:function(e){return e.split("whispers: ")[1]},prefix:function(){return"["+Y.level+':<span class="chat-'+Y.job+'">'+Y.name+"</span>]"},to:function(e){return"You whispered to "+e.name+": "}},friend:{parse:function(e){var i=e.replace(/ +/g," ").split(" ");return i[2][0].toUpperCase()+i[2].substr(1).toLowerCase().trim()},init:function(){O.friends=O.friends||[],e.ajax({type:"GET",url:app.url+"php2/chat/friend-get.php"}).done(function(e){O.friends=e})},list:function(){U.log('<div class="chat-warning">Checking friends list...</div>'),O.friends.length?e.ajax({type:"GET",url:app.url+"php2/chat/friend-status.php"}).done(function(e){O.friends=e.friends,console.info(e);var i=U.divider+"<div>Friend List ("+e.friends.length+")</div>";O.friends.forEach(function(a,t){var n=e.players.indexOf(a);if(n>-1){var o=e.stats[n];i+='<div class="chat-whisper">['+o.level+" "+O.jobLong[o.job]+"] "+O.friends[t]+" ("+o.race+")"+X.format(o)+"</div>"}else i+='<div class="chat-emote">[Offline] '+a+"</div>"}),U.log(i)}):(U.log("<div>You don't have any friends!</div>"),U.log("<div class='chat-emote'>Use /friend [name] to add a new friend.</div>"))},add:function(i){~O.friends.indexOf(i)?U.log(i+" is already your friend.","chat-warning"):i.length>1&&i!==Y.name&&e.ajax({url:app.url+"php2/chat/friend-add.php",data:{friend:i}}).done(function(e){e.error?U.log(e.error,"chat-warning"):(U.log("You have added "+i+" to your friend list.","chat-warning"),V.zmq.subscribe("friend:"+i,function(e,i){U.friend.notify(e,i)}),~O.friends.indexOf(i)||V.zmq.publish("name:"+i,{name:Y.name,route:"friend>addedMe"}),O.friends.push(i))})},remove:function(i){i.length>1&&i!==Y.name&&O.friends.indexOf(i)>-1&&e.ajax({url:app.url+"php2/chat/friend-remove.php",data:{friend:i}}).done(function(e){if(e.error)U.log(e.error,"chat-warning");else{for(U.log("You have removed "+i+" from your friend list.","chat-warning");O.friends.indexOf(i)>-1;){var a=O.friends.indexOf(i);O.friends.splice(a,1)}V.unsubscribe("friend:"+i)}})},notify:function(e,i){"on"===i.route?U.log(i.name+" has come online.","chat-warning"):U.log(i.name+" has gone offline.","chat-warning")}},toPlaytime:function(e){var a=0,t=0;e>=1440&&(a=i.floor(e/1440),e%=1440),e>=60&&(t=i.floor(e/60),e%=60);var n="",o="",l="";return a&&(n+=a+(a>1?" days":" day")),t&&(o+=t+(t>1?" hours":" hour")),l=e,l+=1!==e?" minutes":" minute",a&&t&&e?n+=", ":a&&(n+=" "),t&&(o+=", "),(a||t)&&(l="and "+l),n+o+l},toCreateString:function(e){return(e=new M(e)).toDateString()+" "+e.toLocaleTimeString()},played:function(){e.ajax({type:"GET",url:app.url+"php2/chat/played.php"}).done(function(e){var i=M.now()-T.parse(sessionStorage.getItem("startTime")),a=U.toPlaytime(~~(i/1e5));U.log("Character created: "+U.toCreateString(e.created),"chat-warning"),U.log("Current session duration: "+a,"chat-whisper"),U.log("Total character playtime: "+U.toPlaytime(e.playtime),"chat-whisper")})},who:{parse:function(e){var i=(t=e.replace(/ +/g," ").split(" ")[1])[0].toUpperCase()+t.substr(1).toLowerCase().trim();if(O.jobs.indexOf(i)>-1)return O.jobShort[i];var a=E.keys(O.jobLong),t=t.toUpperCase();return a.indexOf(t)?t:""},all:function(){e.ajax({type:"GET",url:app.url+"php2/chat/who-all.php"}).done(function(e){if(console.info("who ",e),e.len){U.log(U.divider+"There "+(e.len>1?"are":"is")+" currently "+e.len+" "+(e.len,"players")+" in Vandamor.","chat-warning");var i="";e.players.forEach(function(e,a){i+='<div class="chat-whisper">['+e.level+" "+O.jobLong[e.job]+"] "+e.name+" ("+e.race+")"+X.format(e)+"</div>"}),U.log(i,"chat-whisper")}else U.log("Nobody is currently in Vandamor.","chat-warning")})},class:function(i){console.info("who.class ",i),e.ajax({url:app.url+"php2/chat/who-class.php",data:{job:i}}).done(function(e){console.info("r ",e);var a=O.toJobLong(i);if(e.len){U.log(U.divider+"There "+(e.len>1?"are":"is")+" currently "+e.len+" "+(e.len>1?a+"s":a)+" in Vandamor.","chat-warning");var t="";e.players.forEach(function(e,i){t+='<div class="chat-whisper">['+e.level+" "+O.jobLong[e.job]+"] "+e.name+" ("+e.race+")"+X.format(e)+"</div>"}),U.log(t,"chat-whisper")}else a?U.log("Currently there are no "+a+"s in Vandamor.","chat-warning"):U.log("No results found. Try searching by a class name /who cleric.","chat-warning")})}},scrollBottom:function(){!U.isClicked&&U.initialized&&(U.dom.chatLog.scrollTop=U.dom.chatLog.scrollHeight)},inChannel:[],setRoom:function(e){console.info("setRoom",e.length,e);var i="";U.inChannel=[],e.forEach(function(e){U.inChannel.push(1*e.id),i+='<div id="chat-player-'+e.id+'"><span class="chat-player">['+e.level+':<span class="chat-'+e.job+'">'+e.name+"</span>]</span></div>"}),i&&(U.dom.chatRoom.innerHTML=i)},setHeader:function(){U.dom.chatHeader.innerHTML=Y.channel+"&thinsp;("+e(".chat-player").length+")"},join:{parse:function(e){var i=e.replace(/ +/g," ").split(" ");return i[1]===j?"":i[1].toLowerCase().trim()},channel:function(i,a){("town"===O.view||a)&&(i?i!==Y.channel&&e.ajax({url:app.url+"php2/chat/set-channel.php",data:{channel:i}}).done(function(e){U.join.changeCallback(e)}):U.join.default())},default:function(){console.info(Y.channel,U.default),Y.channel!==U.default&&e.ajax({url:app.url+"php2/chat/set-channel.php",data:{channel:U.default}}).done(function(e){U.join.changeCallback(e)})},changeCallback:function(e){U.broadcast.remove(),console.info("You have changed channel to: ",e),U.setRoom(e.players),Y.channel&&V.unsubscribe(U.getChannel()),Y.channel=e.channel,U.log("You have joined channel: "+e.channel,"chat-warning"),V.zmq.subscribe(e.fullChannel,function(e,i){V.routeMainChat(e,i)}),U.setHeader(),U.broadcast.add()}},updateChannel:function(){"town"===O.view&&e.ajax({url:app.url+"php2/chat/update-channel.php",data:{channel:U.default}}).done(function(e){console.info("updateChannel: ",e),U.setRoom(e.players),U.setHeader()})},addPlayer:function(e){if(-1===U.inChannel.indexOf(e.row)){var i=a.createElement("div");i.innerHTML='<div id="chat-player-'+e.row+'"><span class="chat-player">['+e.level+':<span class="chat-'+e.job+'">'+e.name+"</span>]</span></div>",U.dom.chatRoom.appendChild(i),U.inChannel.push(e.row),U.setHeader()}},removePlayer:function(e){var i=a.getElementById("chat-player-"+e.row);null!==i&&i.parentNode.removeChild(i);var t=U.inChannel.indexOf(e.row);U.inChannel.splice(t,1),U.setHeader()},broadcast:{add:function(){console.info("broadcast.add",U.getChannel()),V.zmq.publish(U.getChannel(),{route:"chat->add",row:Y.row,level:Y.level,job:Y.job,name:Y.name})},remove:function(){console.info("broadcast.remove");try{V.zmq.publish(U.getChannel(),{route:"chat->remove",row:Y.row})}catch(e){console.info("broadcast.remove: ",e)}}},size:{small:function(){n.set("#chat-present-wrap",{display:"none"}),n.set("#chat-wrap",{height:"25vh",width:"35vw"}),n.set("#chat-log-wrap",{flexBasis:"100%"})},large:function(){n.set("#chat-present-wrap",{display:"flex"}),n.set("#chat-wrap",{height:"50vh",width:"50vw"}),n.set("#chat-log-wrap",{flexBasis:"70%"})}}},K={initialized:0,init:function(){if(!K.initialized){K.initialized=1;var i=a.getElementById("bar-wrap");i.innerHTML=K.html(),e(".bar-icons").tooltip({animation:!1}),i.style.display="block";for(var t=0;t<q.maxPlayers;t++)K.setEvents(t);K.setAllBars(),e("#bar-wrap").on(z.context,".bar-col-icon",function(i){var a=e(this).attr("id"),t=1*a.split("-")[3];console.info(a,t,Y.party[t].name),N.getPartyMenu(Y.party[t].name)}).on(z.click,"#bar-camp",function(){U.camp()}).on(z.click,"#bar-stats",function(){console.info(e(this).attr("id"))}).on(z.click,"#bar-inventory",function(){console.info(e(this).attr("id"))}).on(z.click,"#bar-options",function(){console.info(e(this).attr("id"))}).on(z.click,"#bar-mission-abandon",function(){ie.abandon()})}},setEvents:function(e){K.dom[e]={playerWrap:a.getElementById("bar-player-wrap-"+e),name:a.getElementById("bar-name-"+e),hpFg:a.getElementById("bar-hp-fg-"+e),mpWrap:a.getElementById("bar-mp-wrap-"+e),mpFg:a.getElementById("bar-mp-fg-"+e)},K.dom.ping=a.getElementById("bar-ping"),K.dom.socket=a.getElementById("bar-socket")},dom:{},getPlayerHtml:function(e,i,a){var t="";return a||(t+='<div id="bar-player-wrap-'+i+'" class="bar-player-wrap'+(i?"":" bar-player-wrap-me")+'" style="display: '+(0===i?"flex":"none")+'">'),t+=K.getPlayerInnerHtml(e,i),a||(t+="</div>"),t},header:function(){var e="";return e+='<div id="bar-lag"><span id="bar-ping"><i class="fa fa-exchange"></i></span><span id="bar-socket"><i class="fa fa-exchange"></i></span></div><div id="bar-header"><i id="bar-camp" class="fa fa-power-off bar-icons" title="Camp"></i><i id="bar-stats" class="fa fa-user-circle-o bar-icons" title="Stat Sheet"></i><i id="bar-inventory" class="fa fa-suitcase bar-icons" title="Inventory"></i><i id="bar-options" class="fa fa-gear bar-icons" title="Options"></i><i id="bar-mission-abandon" class="fa fa-flag bar-icons" title="Abandon Mission"></i></div>'},getPlayerInnerHtml:function(e,i){return'<div id="bar-col-icon-'+i+'" class="bar-col-icon player-icon-'+e.job+'"><div id="bar-is-leader-'+i+'" class="bar-is-leader '+(e.isLeader?"block":"none")+' no-pointer"></div></div><div class="'+(i?"bar-col-data-sm":"bar-col-data")+'"><div id="bar-name-'+i+'" class="bar-hp-name ellipsis">'+e.name+'</div><div id="bar-hp-wrap-'+i+'" class="bar-any-wrap"><div id="bar-hp-fg-'+i+'" class="bar-hp-fg"></div></div><div id="bar-mp-wrap-'+i+'" class="bar-any-wrap"><div id="bar-mp-fg-'+i+'" class="bar-mp-fg"></div></div></div>'},html:function(){var e=K.header();e+='<div id="bar-all-player-wrap">';for(var i=0;i<q.maxPlayers;i++)e+=K.getPlayerHtml(Y.party[i],i);return e+="</div>"},updatePlayerBar:function(e){K.dom[e].playerWrap.style.display="flex",K.dom[e].playerWrap.innerHTML=K.getPlayerInnerHtml(Y.party[e],e),K.setEvents(e),K.setBars(e,0)},setAllBars:function(){for(var e=0;e<q.maxPlayers;e++)K.setHp(e),K.setMp(e)},setBars:function(e,i){K.setHp(e,i),K.setMp(e,i)},updateBars:function(e){for(var i=0,a=Y.party.length;i<a;i++)e.name===Y.party[i].name&&(e.hp&&(Y.party[i].hp=e.hp,K.setHp(i)),e.mp&&(Y.party[i].mp=e.mp,K.setMp(i)))},setHp:function(e,i){if(Y.party[e].name){var a=~~(Y.party[e].hp/Y.party[e].maxHp*100)+"%",i=i===j?.3:i;n.to(K.dom[e].hpFg,i,{width:a})}},setMp:function(e,i){if(Y.party[e].name)if(Y.party[e].maxMp){var a=~~(Y.party[e].mp/Y.party[e].maxMp*100)+"%",i=i===j?.3:i;n.to(K.dom[e].mpFg,i,{width:a})}else K.dom[e].mpWrap.style.display="none"},party:{join:function(e){console.info("bar.party.join ",e),U.log(e.msg,"chat-warning"),K.getParty()},disband:function(e){var i=0,t="",n=0;Y.party.forEach(function(a,o){e.row===a.id&&(i=o,t=a.name,a.isLeader&&(n=1))}),i&&(Y.party[i]=Y.Party(),a.getElementById("bar-player-wrap-"+i).style.display="none",U.log(t+" has disbanded the party.","chat-warning"),n&&Y.isLowestPartyIdMine()&&U.promote(Y.getNewLeaderName(),1)),e.row===Y.row&&U.sendMsg("/disband")},promote:function(e){U.log(e.name+" has been promoted to party leader.","chat-warning"),K.getParty()},boot:function(e){console.info("bar.party.boot ",e),U.log(e.name+" has been booted from the party.","chat-warning"),e.row*=1,K.party.disband(e),K.getParty()}},getParty:function(){console.info("Drawing all bars!"),Y.p_id&&e.ajax({type:"GET",url:app.url+"php2/chat/party-get-all.php"}).done(function(e){console.info("getParty ",e);var i=1;e.party.forEach(function(e,a){console.info("SET BARS ",a,e),e.name===Y.name?(Y.party[0]=e,Y.resetClientPartyValues(0),K.updatePlayerBar(0)):(Y.party[i]=e,Y.resetClientPartyValues(i),K.updatePlayerBar(i++))});for(var t=e.party.length;t<q.maxPlayers;t++)t&&(a.getElementById("bar-player-wrap-"+t).style.display="none",Y.party[t]=Y.Party())})},disband:function(){Y.party.forEach(function(e,i){i&&(Y.party[i]=Y.Party())}),K.hideParty(),V.unsubscribe("party:"+Y.p_id),Y.p_id=0,Y.party[0].isLeader=0,a.getElementById("bar-is-leader-0").style.display="none"},hideParty:function(){Y.party.forEach(function(e,i){i&&(a.getElementById("bar-player-wrap-"+i).style.display="none")})},heartbeat:{receive:function(e){console.info("%c party heartbeat.receive id:","background: #0ff",e.id);for(var i=0,a=1;a<6;a++)e.id===Y.party[a].id&&(i=a);i&&Y.resetClientPartyValues(i)},linkdead:function(e){U.log(e.name+" has gone linkdead.","chat-warning")}},get:function(){},events:function(){}},_={go:function(){"battle"!==O.view&&(U.size.small(),Q.init(),q.emptyScenesExcept("scene-battle"),O.setScene("battle"),n.to("#scene-battle",.5,{delay:.5,opacity:1}),Q.initialized||(Q.initialized=1,Q.imageKeys=E.keys(J.images),Q.index=Q.imageKeys.length-1),oe.init())},html:function(){for(var e='<img id="battle-bg" class="img-bg" src="img2/bg/fw2.jpg">',i=0;i<Q.max;i++){e+='<div id="mob-center-'+i+'" class="mob-center"></div><div id="mob-wrap-'+i+'" class="mob-wrap"><div id="mob-details-'+i+'" class="mob-details" index="'+i+'"><div id="mob-name-'+i+'" class="mob-name text-shadow"></div><div id="mob-bar-'+i+'" class="mob-bar"><div id="mob-health-'+i+'" class="mob-health"></div></div></div><div id="mob-shadow-'+i+'" class="mob-shadow"></div><div class="mob-img-wrap"><img id="mob-img-'+i+'" class="mob-img" src="img2/blank.png"></div><div id="mob-alive-'+i+'" class="mob-alive" index="'+i+'"></div><div id="mob-dead-'+i+'" class="mob-dead" index="'+i+'"></div></div>'}return e},events:function(){e(".mob-alive, .mob-dead, .mob-details").on(z.click,function(){_.setTarget(1*this.getAttribute("index"))})},initialized:0,show:function(){O.setScene("battle"),_.initialized?a.getElementById("scene-battle").style.display="block":(a.getElementById("scene-battle").innerHTML=_.html(),_.events(),_.isInit=1)},setTarget:function(e){console.info("Setting target ",e,M.now())},testInit:function(){for(var e=0;e<Q.max;e++){var i=Q.getRandomMobKey();$.preload.mob(i),Q.setMob(e,i)}},boxCoordsCenter:[192,576,960,1344,1728,384,768,1152,1536],boxCoordsBottom:[180,180,180,180,180,280,280,280,280],getResponsiveCenter:function(e){return~~(_.boxCoordsCenter[e]*(C.innerWidth/1920))},getBox:function(e){var i=_.getResponsiveCenter(e),a=~~(_.boxCoordsBottom[e]+J[e].imgCy*J[e].size);return x={x:~~(i-.5*J[e].w),y:_.boxCoordsBottom[e],cx:i,cy:a}}},J=[];J.images={balrog:{imgW:2e3,imgH:1200,imgCy:360,w:2e3,h:1200,yFloor:-195,yoyo:!0,cache:[],speed:.05,detailAliveBottom:620,detailDeathBottom:240,shadowBottom:40,shadowWidth:400,shadowHeight:80,clickAliveY:20,clickAliveW:230,clickAliveH:500,clickDeadY:-70,clickDeadW:400,clickDeadH:200,enableSecondary:1,enableSpecial:1},"ice-golem":{imgW:1200,imgH:1e3,imgCy:360,w:960,h:800,yFloor:-140,yoyo:!1,cache:[],speed:.045,detailAliveBottom:580,detailDeathBottom:300,shadowBottom:40,shadowWidth:370,shadowHeight:100,clickAliveY:40,clickAliveW:300,clickAliveH:500,clickDeadY:-50,clickDeadW:500,clickDeadH:250,enableSecondary:1,enableSpecial:1},"stone-golem":{imgW:1200,imgH:1e3,imgCy:360,w:960,h:800,yFloor:-140,yoyo:!1,cache:[],speed:.045,detailAliveBottom:580,detailDeathBottom:300,shadowBottom:40,shadowWidth:370,shadowHeight:100,clickAliveY:40,clickAliveW:300,clickAliveH:500,clickDeadY:-50,clickDeadW:500,clickDeadH:250,enableSecondary:1,enableSpecial:1},"iron-golem":{imgW:1200,imgH:1e3,imgCy:360,w:960,h:800,yFloor:-140,yoyo:!1,cache:[],speed:.045,detailAliveBottom:580,detailDeathBottom:300,shadowBottom:40,shadowWidth:370,shadowHeight:100,clickAliveY:40,clickAliveW:300,clickAliveH:500,clickDeadY:-50,clickDeadW:500,clickDeadH:250,enableSecondary:1,enableSpecial:1},treant:{imgW:1300,imgH:1200,imgCy:420,w:1170,h:1080,yFloor:-135,yoyo:!1,cache:[],speed:.05,detailAliveBottom:750,detailDeathBottom:270,shadowBottom:40,shadowWidth:420,shadowHeight:70,clickAliveY:30,clickAliveW:200,clickAliveH:600,clickDeadY:-80,clickDeadW:350,clickDeadH:200,enableSecondary:1,enableSpecial:1},spider:{imgW:1e3,imgH:1e3,imgCy:190,w:1e3,h:1e3,yFloor:-190,yoyo:!1,cache:[],speed:.045,detailAliveBottom:380,detailDeathBottom:270,shadowBottom:40,shadowWidth:900,shadowHeight:100,clickAliveY:10,clickAliveW:800,clickAliveH:280,clickDeadY:50,clickDeadW:500,clickDeadH:180,enableSecondary:1,enableSpecial:1},wolf:{imgW:1e3,imgH:1e3,imgCy:240,w:600,h:600,yFloor:-40,yoyo:!0,cache:[],speed:.045,detailAliveBottom:390,detailDeathBottom:220,shadowBottom:20,shadowWidth:200,shadowHeight:100,clickAliveY:10,clickAliveW:130,clickAliveH:330,clickDeadY:0,clickDeadW:300,clickDeadH:120,enableSecondary:0,enableSpecial:1},rat:{imgW:1100,imgH:1e3,imgCy:135,w:550,h:500,yFloor:-70,yoyo:!1,cache:[],speed:.045,detailAliveBottom:260,detailDeathBottom:200,shadowBottom:40,shadowWidth:200,shadowHeight:80,clickAliveY:30,clickAliveW:150,clickAliveH:180,clickDeadY:20,clickDeadW:210,clickDeadH:120,enableSecondary:0,enableSpecial:1},snake:{imgW:1e3,imgH:1e3,imgCy:160,w:500,h:500,yFloor:-60,yoyo:!1,cache:[],speed:.045,detailAliveBottom:320,detailDeathBottom:200,shadowBottom:40,shadowWidth:200,shadowHeight:60,clickAliveY:30,clickAliveW:150,clickAliveH:230,clickDeadY:0,clickDeadW:150,clickDeadH:100,enableSecondary:0,enableSpecial:1},dragonkin:{imgW:1300,imgH:1300,imgCy:340,w:845,h:845,yFloor:-70,yoyo:!1,cache:[],speed:.055,detailAliveBottom:510,detailDeathBottom:240,shadowBottom:40,shadowWidth:360,shadowHeight:100,clickAliveY:30,clickAliveW:200,clickAliveH:440,clickDeadY:-50,clickDeadW:250,clickDeadH:200,enableSecondary:1,enableSpecial:1},lizardman:{imgW:1100,imgH:1e3,imgCy:350,w:880,h:800,yFloor:-130,yoyo:!0,cache:[],speed:.045,detailAliveBottom:520,detailDeathBottom:250,shadowBottom:40,shadowWidth:320,shadowHeight:60,clickAliveY:20,clickAliveW:160,clickAliveH:450,clickDeadY:0,clickDeadW:300,clickDeadH:140,enableSecondary:1,enableSpecial:1},dragon:{imgW:3e3,imgH:1500,imgCy:240,w:3e3,h:1500,yFloor:-80,yoyo:!0,cache:[],speed:.055,detailAliveBottom:650,detailDeathBottom:350,shadowBottom:40,shadowWidth:640,shadowHeight:160,clickAliveY:-50,clickAliveW:500,clickAliveH:600,clickDeadY:0,clickDeadW:500,clickDeadH:250,enableSecondary:1,enableSpecial:1},ghoul:{imgW:900,imgH:1e3,imgCy:350,w:630,h:700,yFloor:-80,yoyo:!0,cache:[],speed:.045,detailAliveBottom:510,detailDeathBottom:210,shadowBottom:40,shadowWidth:320,shadowHeight:40,clickAliveY:30,clickAliveW:270,clickAliveH:450,clickDeadY:-50,clickDeadW:250,clickDeadH:140,enableSecondary:1,enableSpecial:1},mummy:{imgW:800,imgH:1e3,imgCy:370,w:560,h:700,yFloor:-30,yoyo:!1,cache:[],speed:.04,detailAliveBottom:550,detailDeathBottom:210,shadowBottom:40,shadowWidth:260,shadowHeight:60,clickAliveY:40,clickAliveW:180,clickAliveH:480,clickDeadY:0,clickDeadW:160,clickDeadH:120,enableSecondary:1,enableSpecial:1},skeleton:{imgW:900,imgH:1e3,imgCy:340,w:720,h:800,yFloor:-30,yoyo:!1,cache:[],speed:.045,detailAliveBottom:520,detailDeathBottom:240,shadowBottom:40,shadowWidth:280,shadowHeight:60,clickAliveY:30,clickAliveW:150,clickAliveH:430,clickDeadY:50,clickDeadW:350,clickDeadH:100,enableSecondary:1,enableSpecial:1},vampire:{imgW:1e3,imgH:1e3,imgCy:350,w:650,h:650,yFloor:-60,yoyo:!0,cache:[],speed:.04,detailAliveBottom:510,detailDeathBottom:230,shadowBottom:40,shadowWidth:300,shadowHeight:60,clickAliveY:40,clickAliveW:200,clickAliveH:420,clickDeadY:-50,clickDeadW:250,clickDeadH:200,enableSecondary:1,enableSpecial:1},goblin:{imgW:1e3,imgH:1e3,imgCy:250,w:700,h:700,yFloor:-40,yoyo:!1,cache:[],speed:.042,detailAliveBottom:400,detailDeathBottom:220,shadowBottom:40,shadowWidth:200,shadowHeight:40,clickAliveY:50,clickAliveW:150,clickAliveH:330,clickDeadY:40,clickDeadW:300,clickDeadH:100,enableSecondary:1,enableSpecial:1},hobgoblin:{imgW:1e3,imgH:1e3,imgCy:340,w:1e3,h:1e3,yFloor:-120,yoyo:!1,cache:[],speed:.045,detailAliveBottom:530,detailDeathBottom:220,shadowBottom:40,shadowWidth:340,shadowHeight:70,clickAliveY:40,clickAliveW:220,clickAliveH:450,clickDeadY:0,clickDeadW:330,clickDeadH:150,enableSecondary:1,enableSpecial:1},kobold:{imgW:1400,imgH:1e3,imgCy:230,w:700,h:500,yFloor:-40,yoyo:!1,cache:[],speed:.045,detailAliveBottom:380,detailDeathBottom:200,shadowBottom:40,shadowWidth:230,shadowHeight:60,clickAliveY:30,clickAliveW:170,clickAliveH:310,clickDeadY:10,clickDeadW:250,clickDeadH:100,enableSecondary:1,enableSpecial:1},orc:{imgW:1200,imgH:1e3,imgCy:340,w:960,h:800,yFloor:-55,yoyo:!1,cache:[],speed:.045,detailAliveBottom:520,detailDeathBottom:250,shadowBottom:40,shadowWidth:260,shadowHeight:70,clickAliveY:30,clickAliveW:200,clickAliveH:440,clickDeadY:0,clickDeadW:240,clickDeadH:150,enableSecondary:1,enableSpecial:1},griffon:{imgW:2e3,imgH:1200,imgCy:250,w:1600,h:960,yFloor:-40,yoyo:!1,cache:[],speed:.05,detailAliveBottom:520,detailDeathBottom:230,shadowBottom:40,shadowWidth:280,shadowHeight:80,clickAliveY:20,clickAliveW:180,clickAliveH:380,clickDeadY:20,clickDeadW:400,clickDeadH:130,enableSecondary:1,enableSpecial:1},harpy:{imgW:1500,imgH:1e3,imgCy:290,w:900,h:600,yFloor:-30,yoyo:!1,cache:[],speed:.045,detailAliveBottom:490,detailDeathBottom:270,shadowBottom:40,shadowWidth:300,shadowHeight:40,clickAliveY:50,clickAliveW:200,clickAliveH:400,clickDeadY:50,clickDeadW:350,clickDeadH:130,enableSecondary:1,enableSpecial:1},werewolf:{imgW:1e3,imgH:1e3,imgCy:260,w:800,h:800,yFloor:-60,yoyo:!1,cache:[],speed:.045,detailAliveBottom:450,detailDeathBottom:220,shadowBottom:40,shadowWidth:380,shadowHeight:60,clickAliveY:40,clickAliveW:350,clickAliveH:330,clickDeadY:-20,clickDeadW:400,clickDeadH:200,enableSecondary:1,enableSpecial:1},centaur:{imgW:1500,imgH:1e3,imgCy:330,w:1050,h:700,yFloor:-25,yoyo:!1,cache:[],speed:.045,detailAliveBottom:560,detailDeathBottom:240,shadowBottom:40,shadowWidth:190,shadowHeight:80,clickAliveY:20,clickAliveW:150,clickAliveH:470,clickDeadY:20,clickDeadW:380,clickDeadH:150,enableSecondary:1,enableSpecial:1},cerberus:{imgW:1800,imgH:1200,imgCy:300,w:1200,h:800,yFloor:-50,yoyo:!1,cache:[],speed:.055,detailAliveBottom:530,detailDeathBottom:350,shadowBottom:40,shadowWidth:470,shadowHeight:180,clickAliveY:20,clickAliveW:420,clickAliveH:480,clickDeadY:0,clickDeadW:400,clickDeadH:250,enableSecondary:0,enableSpecial:1},fungoid:{imgW:1e3,imgH:1e3,imgCy:340,w:800,h:800,yFloor:-80,yoyo:!0,cache:[],speed:.045,detailAliveBottom:550,detailDeathBottom:270,shadowBottom:40,shadowWidth:260,shadowHeight:70,clickAliveY:40,clickAliveW:190,clickAliveH:470,clickDeadY:0,clickDeadW:210,clickDeadH:140,enableSecondary:1,enableSpecial:1},gargoyle:{imgW:1200,imgH:1e3,imgCy:300,w:1080,h:900,yFloor:-20,yoyo:!0,cache:[],speed:.045,detailAliveBottom:530,detailDeathBottom:350,shadowBottom:40,shadowWidth:320,shadowHeight:60,clickAliveY:40,clickAliveW:200,clickAliveH:400,clickDeadY:40,clickDeadW:200,clickDeadH:250,enableSecondary:1,enableSpecial:1},beetle:{imgW:1e3,imgH:1e3,imgCy:210,w:600,h:600,yFloor:-60,yoyo:!1,cache:[],speed:.04,detailAliveBottom:370,detailDeathBottom:250,shadowBottom:40,shadowWidth:400,shadowHeight:90,clickAliveY:120,clickAliveW:190,clickAliveH:170,clickDeadY:20,clickDeadW:200,clickDeadH:170,enableSecondary:1,enableSpecial:1},imp:{imgW:1250,imgH:1e3,imgCy:200,w:625,h:500,yFloor:-15,yoyo:!0,cache:[],speed:.045,detailAliveBottom:400,detailDeathBottom:230,shadowBottom:40,shadowWidth:220,shadowHeight:60,clickAliveY:30,clickAliveW:150,clickAliveH:290,clickDeadY:0,clickDeadW:150,clickDeadH:140,enableSecondary:1,enableSpecial:1},minotaur:{imgW:1e3,imgH:1e3,imgCy:380,w:1e3,h:1e3,yFloor:-100,yoyo:!1,cache:[],speed:.045,detailAliveBottom:620,detailDeathBottom:250,shadowBottom:40,shadowWidth:270,shadowHeight:80,clickAliveY:40,clickAliveW:200,clickAliveH:500,clickDeadY:0,clickDeadW:250,clickDeadH:150,enableSecondary:1,enableSpecial:1},aviak:{imgW:1200,imgH:1e3,imgCy:290,w:900,h:750,yFloor:-110,yoyo:!1,cache:[],speed:.04,detailAliveBottom:450,detailDeathBottom:200,shadowBottom:40,shadowWidth:270,shadowHeight:40,clickAliveY:40,clickAliveW:190,clickAliveH:380,clickDeadY:0,clickDeadW:350,clickDeadH:125,enableSecondary:1,enableSpecial:1},elephant:{imgW:1300,imgH:1e3,imgCy:330,w:1300,h:1e3,yFloor:-100,yoyo:!1,cache:[],speed:.05,detailAliveBottom:720,detailDeathBottom:340,shadowBottom:40,shadowWidth:380,shadowHeight:110,clickAliveY:10,clickAliveW:290,clickAliveH:650,clickDeadY:0,clickDeadW:440,clickDeadH:250,enableSecondary:1,enableSpecial:1},lion:{imgW:900,imgH:1200,imgCy:300,w:540,h:720,yFloor:-20,yoyo:!1,cache:[],speed:.05,detailAliveBottom:500,detailDeathBottom:230,shadowBottom:40,shadowWidth:250,shadowHeight:90,clickAliveY:30,clickAliveW:180,clickAliveH:420,clickDeadY:0,clickDeadW:320,clickDeadH:140,enableSecondary:0,enableSpecial:1},crocodile:{imgW:1e3,imgH:1e3,imgCy:120,w:800,h:800,yFloor:-50,yoyo:!1,cache:[],speed:.05,detailAliveBottom:320,detailDeathBottom:250,shadowBottom:40,shadowWidth:420,shadowHeight:110,clickAliveY:10,clickAliveW:330,clickAliveH:240,clickDeadY:30,clickDeadW:370,clickDeadH:170,enableSecondary:1,enableSpecial:1},rhino:{imgW:1200,imgH:1200,imgCy:275,w:1e3,h:1e3,yFloor:-90,yoyo:!1,cache:[],speed:.05,detailAliveBottom:620,detailDeathBottom:320,shadowBottom:40,shadowWidth:370,shadowHeight:130,clickAliveY:20,clickAliveW:280,clickAliveH:540,clickDeadY:0,clickDeadW:450,clickDeadH:240,enableSecondary:1,enableSpecial:0},lioness:{imgW:900,imgH:1200,imgCy:300,w:540,h:720,yFloor:-20,yoyo:!1,cache:[],speed:.045,detailAliveBottom:460,detailDeathBottom:230,shadowBottom:40,shadowWidth:250,shadowHeight:90,clickAliveY:30,clickAliveW:180,clickAliveH:390,clickDeadY:0,clickDeadW:320,clickDeadH:140,enableSecondary:0,enableSpecial:1},bear:{imgW:1e3,imgH:1e3,imgCy:260,w:600,h:600,yFloor:-10,yoyo:!1,cache:[],speed:.05,detailAliveBottom:470,detailDeathBottom:320,shadowBottom:40,shadowWidth:280,shadowHeight:100,clickAliveY:50,clickAliveW:240,clickAliveH:370,clickDeadY:50,clickDeadW:340,clickDeadH:240,enableSecondary:1,enableSpecial:1},toadlok:{imgW:1200,imgH:1e3,imgCy:200,w:600,h:500,yFloor:-35,yoyo:!1,cache:[],speed:.045,detailAliveBottom:390,detailDeathBottom:270,shadowBottom:40,shadowWidth:200,shadowHeight:70,clickAliveY:50,clickAliveW:200,clickAliveH:300,clickDeadY:30,clickDeadW:200,clickDeadH:170,enableSecondary:1,enableSpecial:1},giant:{imgW:1400,imgH:1200,imgCy:480,w:1400,h:1200,yFloor:-150,yoyo:!1,cache:[],speed:.05,detailAliveBottom:830,detailDeathBottom:370,shadowBottom:40,shadowWidth:480,shadowHeight:120,clickAliveY:50,clickAliveW:350,clickAliveH:700,clickDeadY:-50,clickDeadW:350,clickDeadH:400,enableSecondary:1,enableSpecial:1},"ice-giant":{imgW:1400,imgH:1200,imgCy:480,w:1400,h:1200,yFloor:-150,yoyo:!1,cache:[],speed:.06,detailAliveBottom:830,detailDeathBottom:370,shadowBottom:40,shadowWidth:480,shadowHeight:120,clickAliveY:50,clickAliveW:350,clickAliveH:700,clickDeadY:-50,clickDeadW:350,clickDeadH:400,enableSecondary:1,enableSpecial:1},"fire-giant":{imgW:1400,imgH:1200,imgCy:480,w:1400,h:1200,yFloor:-150,yoyo:!1,cache:[],speed:.06,detailAliveBottom:830,detailDeathBottom:370,shadowBottom:40,shadowWidth:480,shadowHeight:120,clickAliveY:50,clickAliveW:350,clickAliveH:700,clickDeadY:-50,clickDeadW:350,clickDeadH:400,enableSecondary:1,enableSpecial:1},spectre:{imgW:1500,imgH:1500,imgCy:455,w:1200,h:1200,yFloor:-220,yoyo:!1,cache:[],speed:.055,detailAliveBottom:610,detailDeathBottom:270,shadowBottom:40,shadowWidth:200,shadowHeight:80,clickAliveY:100,clickAliveW:150,clickAliveH:470,clickDeadY:40,clickDeadW:190,clickDeadH:150,enableSecondary:1,enableSpecial:1},angler:{imgW:1500,imgH:1200,imgCy:235,w:900,h:720,yFloor:-60,yoyo:!1,cache:[],speed:.045,detailAliveBottom:400,detailDeathBottom:270,shadowBottom:40,shadowWidth:240,shadowHeight:60,clickAliveY:50,clickAliveW:200,clickAliveH:280,clickDeadY:10,clickDeadW:200,clickDeadH:120,enableSecondary:1,enableSpecial:1},"evil-eye":{imgW:1200,imgH:1e3,imgCy:240,w:720,h:600,yFloor:-100,yoyo:!1,cache:[],speed:.05,detailAliveBottom:410,detailDeathBottom:270,shadowBottom:40,shadowWidth:250,shadowHeight:80,clickAliveY:50,clickAliveW:200,clickAliveH:300,clickDeadY:50,clickDeadW:200,clickDeadH:200,enableSecondary:1,enableSpecial:1},unicorn:{imgW:2e3,imgH:1200,imgCy:280,w:1600,h:960,yFloor:-40,yoyo:!1,cache:[],speed:.055,detailAliveBottom:450,detailDeathBottom:260,shadowBottom:40,shadowWidth:220,shadowHeight:70,clickAliveY:50,clickAliveW:120,clickAliveH:350,clickDeadY:50,clickDeadW:350,clickDeadH:100,enableSecondary:1,enableSpecial:1},scorpion:{imgW:1e3,imgH:1e3,imgCy:135,w:600,h:600,yFloor:0,yoyo:!1,cache:[],speed:.045,detailAliveBottom:450,detailDeathBottom:270,shadowBottom:40,shadowWidth:400,shadowHeight:80,clickAliveY:50,clickAliveW:350,clickAliveH:350,clickDeadY:50,clickDeadW:350,clickDeadH:100,enableSecondary:1,enableSpecial:1}};var Q={test:0,imageKeysLen:0,index:0,cache:{},imageKeys:[],getRandomMobKey:function(){var e=~~(i.random()*Q.imageKeysLen);return Q.imageKeys[e]},initialized:0,max:9,init:function(){Q.imageKeys=E.keys(J.images),Q.imageKeysLen=Q.imageKeys.length,_.show();for(var e=0;e<Q.max;e++)J[e]={hp:1,index:e,frame:0,lastFrame:0,animationActive:0,size:e<5?1:.85,deathState:0,speed:0,type:"",box:{},dom:{}},["wrap","center","alive","dead","img","details","name","shadow","bar"].forEach(function(i){J[e].dom[i]=a.getElementById("mob-"+i+"-"+e)})},element:{},animationActive:0,frame:1,setMob:function(e,i){J[e].type=i,J[e]=E.assign(J[e],J.images[i]),delete J[e].cache,Q.sizeMob(e),Q.resetIdle(e),Q.idle(e)},sizeMob:function(e){var i=J[e],a=~~(i.size*J.images[i.type].w);i.box=_.getBox(i.index),i.dom.name.innerHTML=i.type.replace(/-/g," "),i.dom.details.style.display="block",i.dom.img.style.left=-.5*a+"px",i.dom.img.style.width=a+"px",i.dom.img.style.bottom=J.images[i.type].yFloor*i.size+"px",i.dom.img.src="mobs/"+i.type+"/1.png",n.set(i.dom.details,{bottom:i.detailAliveBottom*i.size}),i.dom.shadow.style.display="block",i.dom.shadow.style.width=i.shadowWidth*i.size+"px",i.dom.shadow.style.height=i.shadowHeight*i.size+"px",i.dom.shadow.style.left=i.shadowWidth*i.size*-.5+"px",i.dom.shadow.style.bottom=(i.shadowBottom-.3*i.shadowHeight)*i.size+"px",i.dom.center.style.left=i.box.cx-11+"px",i.dom.center.style.bottom=i.box.cy-11+"px",Q.setClickBox(i)},setClickBox:function(e){e.dom.alive.style.left=e.clickAliveW*e.size*-.5+"px",e.dom.alive.style.bottom=e.clickAliveY*e.size+"px",e.dom.alive.style.width=e.clickAliveW*e.size+"px",e.dom.alive.style.height=e.clickAliveH*e.size+"px",e.dom.alive.style.display=e.hp?"block":"none",e.dom.dead.style.left=e.clickDeadW*e.size*-.5+"px",e.dom.dead.style.bottom=e.clickDeadY*e.size+"px",e.dom.dead.style.width=e.clickDeadW*e.size+"px",e.dom.dead.style.height=e.clickDeadH*e.size+"px",e.dom.dead.style.display=e.hp?"none":"block"},setSrc:function(e){J[e].frame=~~J[e].frame,J[e].frame!==J[e].lastFrame&&(J[e].dom.img.src="mobs/"+J[e].type+"/"+J[e].frame+".png",J[e].lastFrame=J[e].frame)},resetIdle:function(e){J[e].animationActive=0,Q.idle(J[e].index,1)},idle:function(e,i){var a=J[e];n.to(a,4.9*a.speed*2,{startAt:{frame:1},frame:5.9,yoyo:!0,repeat:-1,repeatDelay:a.speed,ease:y.easeOut,onUpdate:function(){Q.setSrc(a.index)}}),i||n.delayedCall(.25,function(){Q.test&&Q.hit(a.index)})},hit:function(e){var i=J[e];if(!i.animationActive){i.animationActive=1;n.to(i,9.9*i.speed,{startAt:{frame:6},overwrite:1,frame:15.9,ease:Linear.easeNone,yoyo:!0,repeat:1,onUpdate:function(){Q.setSrc(i.index)},onComplete:function(){Q.resetIdle(i.index),Q.test&&n.delayedCall(.5,function(){Q.attack(i.index,1)})}})}},attack:function(e,a){var t=J[e];if(!t.animationActive){t.animationActive=1;var o=O.TM(),l=1===a||2===a?a:i.round(i.random())?2:1;t.enableSecondary||(l=1);var s=1===l?16:35.9,r=s+20,c=r-s;o.to(t,t.speed*c,{startAt:{frame:s},overwrite:1,frame:r,ease:Linear.easeNone,onUpdate:function(){Q.setSrc(t.index)},onComplete:function(){Q.resetIdle(t.index),Q.test&&(1===a?n.delayedCall(.5,function(){Q.attack(t.index,2)}):3===a?n.delayedCall(.5,function(){Q.death(t.index)}):n.delayedCall(.5,function(){Q.special(t.index)}))}})}},special:function(e){var i=J[e];if(!i.animationActive)if(i.enableSpecial){i.animationActive=1;O.TM().to(i,i.speed*(75.9-56),{startAt:{frame:56},overwrite:1,frame:75.9,ease:Linear.easeNone,yoyo:i.yoyo,repeat:i.yoyo?1:0,onUpdate:function(){Q.setSrc(i.index)},onComplete:function(){Q.resetIdle(i.index),Q.test&&n.delayedCall(.5,function(){Q.death(i.index)})}})}else Q.attack(i.index,3)},death:function(e){var i=J[e];if(!i.deathState){i.deathState=1,i.hp=0,Q.setClickBox(i),i.animationActive=1;var a=O.TM(),t=i.speed*(105.9-76);n.to(i.dom.details,t,{bottom:i.detailDeathBottom*i.size,ease:Quart.easeIn}),a.to(i,t,{startAt:{frame:76},overwrite:1,frame:105.9,ease:Linear.easeNone,onUpdate:function(){Q.setSrc(i.index)},onComplete:function(){var e={opacity:"opacity(100%)",brightness:"brightness(100%)"},a=i.dom.wrap;new o({onUpdate:function(){le.filters.death(a,e)}}).to(e,2,{opacity:"opacity(0%)",brightness:"brightness(0%)",ease:Linear.easeIn,onComplete:function(){Q.test&&(i.hp=1,Q.sizeMob(i.index),Q.idle(i.index)),n.delayedCall(.1,function(){i.deathState=0,i.animationActive=0,a.style.filter="opacity(100%) brightness(100%)"})}})}})}},deathState:0,blur:function(){var e=a.getElementById("sprite"),i={blur:"blur(0px)"};n.to(i,1.5,{blur:"blur(5px)",yoyo:!0,repeat:-1,onUpdate:function(){Q.filters.effect(e,i,"blur")}})},brightness:function(){var e=a.getElementById("sprite"),i="brightness",t={brightness:i+"(0%)"};n.to(t,1.5,{brightness:i+"(100%)",yoyo:!0,repeat:-1,onUpdate:function(){Q.filters.effect(e,t,i)}})},contrast:function(){var e=a.getElementById("sprite"),i={contrast:"contrast(0%)"};n.to(i,1.5,{contrast:"contrast(200%)",yoyo:!0,repeat:-1,onUpdate:function(){Q.filters.effect(e,i,"contrast")}})},grayscale:function(){var e=a.getElementById("sprite"),i={grayscale:"grayscale(0%)"};n.to(i,1.5,{grayscale:"grayscale(100%)",yoyo:!0,repeat:-1,onUpdate:function(){Q.filters.effect(e,i,"grayscale")}})},invert:function(){var e=a.getElementById("sprite"),i={invert:"invert(0%)"};n.to(i,1.5,{invert:"invert(400%)",yoyo:!0,repeat:-1,onUpdate:function(){Q.filters.effect(e,i,"invert")}})},saturate:function(){var e=a.getElementById("sprite"),i={saturate:"saturate(0%)"};n.to(i,1.5,{saturate:"saturate(500%)",yoyo:!0,repeat:-1,onUpdate:function(){Q.filters.effect(e,i,"saturate")}})},sepia:function(){var e=a.getElementById("sprite"),i={sepia:"sepia(0%)"};n.to(i,1.5,{sepia:"sepia(100%)",yoyo:!0,repeat:-1,onUpdate:function(){Q.filters.effect(e,i,"sepia")}})}},Z={go:function(){"town"!==O.view&&L.selected&&(q.emptyScenesExcept("scene-town"),O.lock(1),U.size.large(),e.ajax({url:app.url+"php2/character/load-character.php",data:{row:L.selected}}).done(function(i){console.info("load-character: ",i);var o=i.characterData;Y.name=o.name,Y.job=o.job,Y.race=o.race,Y.level=o.level,Y.row=o.row,Y.party[0]=o,Y.party[0].isLeader=0,Y.resetClientPartyValues(0),Y.guild=i.guild,i.quest.level&&(ie.setQuest(i.quest),Y.zoneMobs=i.zoneMobs);for(var l=1;l<q.maxPlayers;l++)Y.party[l]=Y.Party();console.info("my.party[0]: ",Y.party[0]),O.setScene("town"),U.init(),V.init(),U.friend.init(),U.ignore.init(),U.log("There are currently "+i.count+" players exploring Vandamor.","chat-emote"),a.getElementById("scene-town").innerHTML=Z.html(),Z.events(),e("#scene-title").remove(),Z.init(),q.start(),K.init(),i.party!==j&&i.party.id&&(i.party.id*=1,Y.p_id=i.party.id),function e(){V.enabled?(V.initParty(Y.p_id),K.getParty(),U.sendMsg("/join"),i.dungeon?ae.go():n.to("#scene-town",.5,{delay:.5,opacity:1,onComplete:function(){O.unlock(),v(function(){},2500)}})):v(e,100)}(),app.isLocal&&i.quest.level&&("#battle"===t.hash?_.go():"#dungeon"===t.hash&&ae.go())}).fail(function(e){O.disconnect(e.responseText)}).always(function(){O.unlock()}))},html:function(){return'<img id="town-bg" class="img-bg" src="img2/town2.jpg"><div id="town-menu" class="text-shadow"><div id="town-merchant" class="ng-btn town-action">Merchant</div><div id="town-trainer" class="ng-btn town-action">Skill Trainer</div><div id="town-guild" class="ng-btn town-action">Guild Hall</div></div><div id="town-footer" class="text-shadow2"><hr id="town-footer-hr1" class="footer-hr"><div id="town-footer-flex"><span id="town-mission" class="ng-btn town-action center">Mission Counter</span></div><hr id="town-footer-hr2"  class="footer-hr"></div>'},aside:{selected:"",html:{close:'<i class="close-aside fa fa-times text-danger"></i>',sleeve:'<div class="stag-blue sleeve"></div>',"town-merchant":function(e){return'<img class="aside-bg" src="img2/town/halas.jpg"><img class="aside-npc" src="img2/town/rendo-surefoot.png"><div class="aside-text"><div class="aside-title-wrap stag-blue"><div class="aside-title">Merchant</div>'+Z.aside.html.close+"</div></div>"},"town-trainer":function(e){return'<img class="aside-bg" src="img2/town/surefall.jpg"><img class="aside-npc" src="img2/town/arwen-reinhardt.png"><div class="aside-text"><div class="aside-title-wrap stag-blue"><div class="aside-title">Skill Trainer</div>'+Z.aside.html.close+"</div></div>"},"town-guild":function(e){return'<img class="aside-bg" src="img2/town/poh.jpg"><img class="aside-npc" src="img2/town/valeska-windcrest.png"><div class="aside-text"><div class="aside-title-wrap stag-blue"><div class="aside-title">Guild Hall</div>'+Z.aside.html.close+'</div><div id="aside-menu">'+Z.aside.menu[e]()+"</div></div>"},"town-mission":function(e){return'<img class="aside-bg" src="img2/town/neriak.jpg"><img class="aside-npc" src="img2/town/miranda-crossheart.png"><div class="aside-text"><div class="aside-title-wrap stag-blue"><div class="aside-title">Mission Counter</div>'+Z.aside.html.close+'</div><div id="aside-menu">'+Z.aside.menu[e]()+"</div></div>"}},menu:{"town-trainer":function(){return""},"town-merchant":function(){return""},"town-guild":function(){var e="";return Y.guild.name?(e+='<div class="aside-frame"><div>Guild: '+Y.guild.name+"</div> <div>Title: "+X.ranks[Y.guild.rank]+"</div> <div>Total Members: "+Y.guild.members+"</div> <div>Member Number: "+Y.guild.memberNumber+'</div> </div><div id="guild-member-wrap" class="aside-frame"><div id="guild-member-flex"><div id="guild-member-label">Guild Members:</div><div id="guild-member-refresh-icon"><i class="fa fa-refresh refresh"></i></div></div><div id="aside-guild-members"></div></div>',e+="</div>"):e+='<input id="guild-input" class="text-shadow" type="text" maxlength="30" autocomplete="off" spellcheck="false"><div id="guild-create" class="ng-btn">Create Guild</div> <div class="aside-frame">Only letters A through Z and apostrophes are accepted in guild names. Standarized capitalization will be automatically applied. The guild name must be between 4 and 30 characters. All guild names are subject to the royal statutes regarding common decency in Vandamor.</div>',e},"town-mission":function(){var e=ie.asideHtmlHead();return ie.loaded?(e+='<div id="mission-counter" class="aside-frame text-shadow">',e+=ie.asideHtml(),e+="</div>",v(function(){ie.openFirstTwoZones()},100)):(e+='<div id="mission-counter" class="aside-frame">'+O.loadMsg+"</div>",ie.init()),Y.quest.level&&(e+=ie.asideFooter()),e}},init:function(i){if(i!==Z.aside.selected){var t=e(".town-aside");n.to(t,.2,{scale:0,x:Z.lastAside.x+"%",y:Z.lastAside.y+"%",onComplete:function(){t.remove()}}),Z.lastAside=Z.data[i].aside,n.to("#town-bg",1.25,{scale:1.5,x:Z.data[i].bg.x,y:Z.data[i].bg.y}),"town-mission"===i&&ie.resetMissionLists();var o=a.createElement("div");o.className="town-aside text-shadow";var l=Z.aside.html[i](i);o.innerHTML=l,a.getElementById("scene-town").appendChild(o),v(function(){n.set(".now-loading",{alpha:0}),n.to(o,.5,{startAt:{display:"block",alpha:1,scale:0,x:Z.data[i].aside.x+"%",y:Z.data[i].aside.y+"%"},x:"2%",y:"2%",scale:1,onComplete:function(){n.to(".now-loading",.3,{alpha:1})}}),v(function(){n.to(".aside-bg",1,{startAt:{left:"60%"},left:"50%"},100)}),n.to(".aside-npc",1,{left:"-5%"}),v(function(){e(".town-aside:last-child").find("input").focus(),Z.data[i].msg()},100)},Z.aside.selected?0:500),Z.aside.selected=i,"town-guild"===i&&(X.memberList.length?X.setGuildList(X):(e("#aside-guild-members").html("Loading..."),X.getMembers(0)))}},update:function(i){var a=Z.aside.menu[i]();e("#aside-menu").html(a)}},lastAside:{},delegated:0,events:function(){Z.delegated||(Z.delegated=1,e("#scene-town").on(z.click,".close-aside",function(){Z.aside.selected="";var i=e(".town-aside");n.to(i,.3,{scale:0,onComplete:function(){i.remove()}}),n.to("#town-bg",.5,{scale:1,x:"-50%",y:"-50%"})}).on(z.click,"#guild-create",function(){X.create()}).on(z.click+" focus","#guild-input",function(){X.hasFocus=1}).on("blur","#guild-input",function(){X.hasFocus=0}).on(z.click,"#guild-member-refresh-icon",function(){e("#aside-guild-members").html(O.loadMsg),X.getMembers(1500)}).on(z.click,".town-action",function(){Z.aside.init(e(this).attr("id"))}))},data:{"town-merchant":{msg:function(){U.log('Rendo Surefoot says, "Hello, '+Y.name+". I have got a once-in-a-lifetime smokin' deal for you, my friend! Today, we just received a limited edition Lanfeld champion sword from our supply chain!\"")},bg:{x:"-75%",y:"-60%"},aside:{x:112,y:30}},"town-trainer":{msg:function(){U.log('Arwen Reinhardt says, "Hail to thee, '+Y.name+". You had better sharpen up your skills, kiddo, or you'll be dead meat out there. Take it from me—a battle-hardened warrior that has seen more than his fair share of death and despair.\"")},bg:{x:"-75%",y:"-25%"},aside:{x:112,y:-10}},"town-guild":{msg:function(){U.log('Valeska Windcrest says, "Good day, '+Y.name+'. What would you ask of me?"')},bg:{x:"-25%",y:"-25%"},aside:{x:-30,y:-30}},"town-mission":{msg:function(){U.log('Miranda Crossheart says, "Hey, sunshine! Are you itching for a bit of action?! There\'s no shortage of miscreants to dispatch around these parts!"')},bg:{x:"-67%",y:"-60%"},aside:{x:75,y:24}}},initialized:0,init:function(){Z.initialized||(Z.initialized=1,sessionStorage.getItem("startTime")||sessionStorage.setItem("startTime",T.stringify(M.now())),Z.preload())},preload:function(){var e="img2/town/";$.preload.images([e+"arwen-reinhardt.png",e+"halas.jpg",e+"miranda-crossheart.png",e+"neriak.jpg",e+"poh.jpg",e+"rendo-surefoot.png",e+"surefall.jpg",e+"valeska-windcrest.png","img2/dungeon/braxxen1.jpg","img2/skills/"+Y.job+".png"])}},X={Guild:function(){return{id:0,rank:0,memberNumber:0,motd:"",members:0,name:"",memberList:[]}},format:function(e){return e.guild?" &lt;"+e.guild+"&gt;":""},hasFocus:0,ranks:["Leader","Officer","Member"],create:function(){if(!O.locked){var i=e("#guild-input").val().replace(/ +/g," ").trim();console.info("Name: ",i),O.lock(),e.ajax({url:app.url+"php2/guild/create.php",data:{name:i.replace(/ +/g," ").trim()}}).done(function(e){console.info("create",e.guild),Y.guild=e.guild,U.log('Valeska Windcrest says, "By the powers vested in me, I hereby declare you supreme sovereign Leader of a new guild: '+e.guild.name+'."'),U.log("Type /help to view guild commands","chat-emote"),V.initGuild(),Z.aside.update("town-guild"),X.getMembers()}).fail(function(i){console.info(i),e("#guild-input").focus(),O.msg(i.responseText)}).always(function(){O.unlock()})}},invite:function(i){Y.name===i?U.log("You can't invite yourself to a guild. Go to the Guild Hall to create a guild.","chat-warning"):Y.guild.id?Y.guild.rank>1?U.log("Only the guild Leader and Officers may send guild invites.","chat-warning"):i?(U.log("Sent guild invite to "+i+".","chat-warning"),e.ajax({url:app.url+"php2/guild/invite.php",data:{player:i}}).done(function(e){}).fail(function(e){U.log(e.responseText,"chat-warning")})):U.log("Syntax: /invite [player_name]","chat-warning"):U.log("You're not in a guild.","chat-warning")},join:function(i){Y.guild.id||(console.info("JOINING GUILD!",i),e.ajax({url:app.url+"php2/guild/join.php",data:{row:i.row,guildName:i.guildName}}).done(function(e){Y.guild=e.guild,U.log("You have joined the guild: "+e.guild.name,"chat-warning"),V.initGuild()}).fail(function(e){console.info("Oh no",e),U.log(e.responseText,"chat-warning")}))},hasJoined:function(e){U.log(e.msg,"chat-warning")},quit:function(){if(Y.guild.id){console.info("Quitting guild!");var i=Y.guild;e.ajax({url:app.url+"php2/guild/quit.php"}).done(function(e){Y.guild=X.Guild(),console.info("guild.quit() response ",e),U.log("You have quit the guild: "+i.name,"chat-warning"),V.unsubscribe("guild:"+i.id)}).fail(function(e){U.log(e.responseText,"chat-warning")})}},hasQuit:function(e){U.log(e.msg,"chat-warning")},boot:function(i){Y.guild.rank>1?U.log("Only the guild Leader and Officers can boot people from the guild","chat-warning"):e.ajax({url:app.url+"php2/guild/boot.php",data:{name:i}}).done(function(){}).fail(function(e){U.log(e.responseText,"chat-warning")})},wasBooted:function(i){Y.guild.id&&(console.info("Booting! ",i),U.log(i.msg,"chat-warning"),i.name===Y.name&&e.ajax({url:app.url+"php2/guild/quit.php",data:{action:"boot"}}).done(function(){V.unsubscribe("guild:"+Y.guild.id),Y.guild=X.Guild()}).fail(function(e){U.log(e.responseText,"chat-warning")}))},promote:function(i){Y.guild.rank>1?U.log("Only the guild Leader and Officers can promote members.","chat-warning"):e.ajax({url:app.url+"php2/guild/promote.php",data:{name:i}}).done(function(){}).fail(function(e){U.log(e.responseText,"chat-warning")})},wasPromoted:function(e){Y.guild.id&&(U.log(e.msg,"chat-warning"),X.updateSession(e))},leader:function(i){Y.guild.rank>0?U.log("Only the guild Leader can assign a new leader.","chat-warning"):e.ajax({url:app.url+"php2/guild/leader.php",data:{name:i}}).done(function(e){console.info("leader: ",e),Y.guild.rank=1}).fail(function(e){U.log(e.responseText,"chat-warning")})},wasLeader:function(e){Y.guild.id&&(U.log(e.msg,"chat-warning"),X.updateSession(e))},updateSession:function(i){i.name===Y.name&&e.ajax({type:"GET",url:app.url+"php2/guild/update-session.php"}).done(function(e){console.info("update-session: ",e),Y.guild=e.guild}).fail(function(e){U.log(e.responseText,"chat-warning")})},motdParse:function(e){var i=e.replace(/ +/g," ").split(" ");return i.shift(),i.join(" ")},motd:function(i){Y.guild.rank>1||e.ajax({url:app.url+"php2/guild/motd.php",data:{msg:i}}).done(function(e){}).fail(function(e){U.log(e.responseText,"chat-warning")})},zmqMotd:function(e){U.log(e.msg,"chat-guild")},getMembers:function(i){Y.guild.id&&(O.lock(1),e.ajax({type:"GET",url:app.url+"php2/guild/get-member-list.php"}).done(function(e){console.info(e),v(function(){X.setGuildList(e)},i)}).fail(function(e){U.log(e.responseText,"chat-warning")}).always(function(){v(function(){O.unlock()},i)}))},memberList:[],setGuildList:function(i){var a="";X.memberList=i.memberList,X.memberList.forEach(function(e){a+="<div>"+e.level+" "+e.name+" "+e.race+' <span class="chat-'+e.job+'">'+O.toJobLong(e.job)+"</span></div>"}),e("#aside-guild-members").html(a)}},$={images:[],imageStrings:[],audio:[],audioStrings:[],preload:{mob:function(e){for(var i=[],a=1;a<=105;a++)i[a]="mobs/"+e+"/"+a+".png";$.preload.images(i)},images:function(e){var i;e.forEach(function(e){e&&!~$.imageStrings.indexOf(e)&&((i=new Image).src=e,$.images.push(i),$.imageStrings.push(e))})},audio:function(e){var i;e.forEach(function(e){~$.audioStrings.indexOf(e)||((i=new Audio).src=e,$.audio.push(i),$.audioStrings.push(e))})}},clear:{all:function(){$.clear.images(),$.clear.audio()},images:function(){$.images=[],$.imageStrings=[]},audio:function(){$.audio=[],$.audioStrings=[]}}},ee={town:function(e,i){"chat->log"===i?e.name===Y.name?U.log(e.msg,e.class):-1===O.ignore.indexOf(e.name)?U.log(e.msg,e.class):console.info("Message from "+e.name+" has been ignored."):"chat->add"===i?U.addPlayer(e):"chat->remove"===i&&U.removePlayer(e)},party:function(e,i){if("party->hb"===i)K.heartbeat.receive(e);else if("party->updateBars"===i)K.updateBars(e);else if("party->notifyMissionStatus"===i)ne.notifyMissionStatus(e);else if("party->missionUpdate"===i)ne.missionUpdate(e);else if("party->linkdead"===i)K.heartbeat.linkdead(e);else if("party->join"===i)K.party.join(e);else if("party->disband"===i)K.party.disband(e);else if("party->promote"===i)K.party.promote(e);else if("party->boot"===i)K.party.boot(e);else if("party->bootme"===i){var a=Y.getPartySlotByRow(1*e.id),t=0;Y.party[a].isLeader&&(t=1),Y.party[a]=Y.Party(),Y.isLowestPartyIdMine()&&(U.boot(e.name,1),1===Y.partyCount()?(console.info("partyCount === 1 "),U.disband()):t&&U.promote(Y.name,1)),v(function(){K.getParty()},1e3)}},guild:function(e,i){"guild->hasJoined"===i?X.hasJoined(e):"guild->quit"===i?X.hasQuit(e):"guild->boot"===i?X.wasBooted(e):"guild->promote"===i?X.wasPromoted(e):"guild->leader"===i?X.wasLeader(e):"guild->motd"===i&&X.zmqMotd(e)}},ie={data:{},loaded:0,delegated:0,zones:[{name:"Ashenflow Peak",level:35,id:14,isOpen:0},{name:"Galeblast Fortress",level:35,id:13,isOpen:0},{name:"Anuran Ruins",level:32,id:12,isOpen:0},{name:"Fahlnir Citadel",level:28,id:11,isOpen:0},{name:"Temple of Prenssor",level:24,id:10,isOpen:0},{name:"Arcturin's Crypt",level:20,id:9,isOpen:0},{name:"Sylong Mausoleum",level:16,id:8,isOpen:0},{name:"Kordata Cove",level:12,id:7,isOpen:0},{name:"Babel's Bastille",level:8,id:6,isOpen:0},{name:"Lanfeld Refuge",level:5,id:5,isOpen:0},{name:"Riven Grotto",level:5,id:4,isOpen:0},{name:"Greenthorn Cavern",level:5,id:3,isOpen:0},{name:"Tendolin Hollow",level:1,id:2,isOpen:0},{name:"Salubrin Den",level:1,id:1,isOpen:0}],resetMissionLists:function(){ie.zones.forEach(function(e){e.isOpen=0})},getDiffClass:function(e){var i="mission-grey";return e>=Y.level+3?i="mission-red":e>Y.level?i="mission-yellow":e===Y.level?i="mission-white":e>=~~(.88*Y.level)?i="mission-high-blue":e>=~~(.77*Y.level)?i="mission-low-blue":e>=~~(.66*Y.level)&&(i="mission-green"),i},init:function(){O.lock(1),e.ajax({url:app.url+"php2/mission/load-mission-data.php"}).done(function(e){console.info("load-mission-data",e.mission),ie.loaded=1,ie.data=e.mission,ie.show(),ie.openFirstTwoZones(),O.unlock()}).fail(function(e){U.log(e.responseText,"chat-alert"),O.unlock()}),ie.delegated||(ie.delegated=1,e("#scene-town").on(z.click,".mission-zone",function(){console.info(".mission-zone CLICK"),ie.toggleZone(e(this))}).on(z.click,".mission-quest-item",function(){ie.clickQuest(e(this))}).on(z.click,"#mission-embark",function(){ie.embark()}).on(z.click,"#mission-abandon",function(){ie.abandon()}))},showEmbark:function(){e("#mission-help").css("display","none"),e("#mission-embark").css("display","block")},updateTitle:function(){e("#mission-title").html(ie.quests[Y.selectedQuest].title)},asideHtmlHead:function(){var e="Mission Counter",i="The party leader must select a zone and embark to begin!",a="none",t="block";ne.isSoloOrLeading()&&(e="Select A Mission",i="Select a quest from any zone and embark to venture forth!"),Y.quest.level&&(e=Y.quest.title,a="block",t="none");return'<div id="mission-wrap" class="aside-frame text-center"><div id="mission-title">'+e+'</div><div id="mission-embark" class="ng-btn '+a+'">Embark!</div><div id="mission-help" class=" '+t+'">'+i+"</div></div>"},asideHtml:function(){var e="";return ie.zones.forEach(function(i){Y.level>=i.level&&(e+='<div class="mission-zone" data-id="'+i.id+'"><div class="fa-stack fa fa-mission-stack"><i class="fa fa-square fa-stack-1x mission-plus-bg text-shadow"></i><i class="fa fa-plus fa-stack-1x mission-plus text-shadow"></i></div><div>'+i.name+'</div></div><div id="mission-zone-'+i.id+'" class="mission-quest-list">'+O.loadMsg+"</div>")}),e},asideFooter:function(){var e="";return ne.isSoloOrLeading()&&(e+='<div id="mission-footer" class="aside-frame text-shadow"><div id="mission-abandon" class="ng-btn ng-btn-alert">Abandon Mission</div></div>'),e},questHtml:function(i){console.info("load-zone-missions",i);var a="";i.quests!==j&&i.quests.forEach(function(e){a+='<div class="mission-quest-item ellipsis '+ie.getDiffClass(e.level)+'" data-id="'+e.row+'" data-zone="'+e.zone+'" data-level="'+e.level+'">'+e.title+"</div>"}),a||(a='<div class="mission-quest-item">No missions found.</div>'),e("#mission-zone-"+i.id).html(a)},show:function(){e("#mission-counter").html(ie.asideHtml())},updateTitle:function(){e("#mission-title").html(Y.quest.title)},updateAll:function(){e("#aside-menu").html(Z.aside.menu["town-mission"]())},loadQuests:function(i){console.info("LOADING QUESTS: ",i),O.lock(1),e.ajax({url:app.url+"php2/mission/load-zone-missions.php",data:{id:i}}).done(function(e){e.id=i,O.unlock(),console.info("load-zone-missions",e),e.quests.forEach(function(e){ie.quests[e.row]=e}),ie.questHtml(e)}).fail(function(e){O.msg(e.responseText),O.unlock()})},toggleZone:function(i){console.info("toggleZone: ",i.data("id"));var a=ie.findIndexById(1*i.data("id")),t=ie.zones[a].id,n=ie.zones[a];if(console.info("JSON ",T.parse(T.stringify(n))),console.info(a,"isOpen: ",n.isOpen),n.isOpen){o=i.find(".mission-minus");console.info("CLOSE MENU: ",o),o.removeClass("fa-minus mission-minus").addClass("fa-plus mission-plus"),e("#mission-zone-"+t).css("display","none"),n.isOpen=0}else{var o=i.find(".mission-plus");console.info("OPEN MENU: ",o),o.removeClass("fa-plus mission-plus").addClass("fa-minus mission-minus"),e("#mission-zone-"+t).css("display","block"),n.isOpen=1,ie.loadQuests(t)}},findIndexById:function(e){var i=0;return ie.zones.forEach(function(a,t){e===a.id&&(i=t)}),i},quests:[],clickQuest:function(e){var i=1*e.data("id");i&&ne.isSoloOrLeading()&&(Y.selectedQuest=i,console.info("QUEST SELECTED: ",i),ie.showEmbark(),ie.updateTitle())},embark:function(){ne.isSoloOrLeading()?(O.lock(1),e.ajax({url:app.url+"php2/mission/embark-quest.php",data:{quest:ie.quests[Y.selectedQuest]}}).done(function(e){console.info("embark isLeader! ",e),ie.setQuest(ie.quests[Y.selectedQuest]),Y.zoneMobs=e.zoneMobs,n.to("#scene-town",3,{startAt:{opacity:1},opacity:0,ease:d.easeOut}),v(function(){ae.go()},q.questDelay)}).fail(function(e){O.msg(e.responseText)}).always(function(){O.unlock()})):Y.quest.level?ae.go():U.log("Quest data not found.","chat-alert"),e(".close-aside").trigger("click")},initQuest:function(){Y.selectedQuest="",Y.quest={},ie.updateAll()},setQuest:function(e){console.info("SETTING QUEST",e),Y.selectedQuest=e.row,Y.quest=e},abandon:function(){Y.quest.level?ne.isSoloOrLeading()?"battle"===O.view?U.log("You cannot abandon missions while in combat!","chat-warning"):(O.lock(1),e.ajax({url:app.url+"php2/mission/abandon-quest.php"}).done(function(e){console.info("abandon ",e)}).fail(function(e){U.log(e.responseText,"chat-alert")}).always(function(){v(function(){O.unlock()},q.questDelay)})):U.log("Only party leaders can abandon missions, but you can /disband the party to quit.","chat-warning"):U.log("You have not started a mission!","chat-warning")},abort:function(){v(function(){oe.hide(),U.log("Mission abandoned!","chat-warning"),"dungeon"===O.view&&(U.log("Returning to town...","chat-warning"),O.lock(1),function i(){Y.party[0].isLeader?ie.abortCallback():e.ajax({type:"GET",url:app.url+"php2/session/init-quest.php"}).done(function(){ie.abortCallback()}).fail(function(){i()})}())})},abortCallback:function(){q.heartbeat.enabled=0,e.ajax({type:"GET",url:app.url+"php2/chat/delete-from-players.php"}),ie.initQuest(),U.join.channel("town",1),n.to("#scene-dungeon",2,{delay:1,opacity:0}),v(function(){O.unlock(),Z.go(),U.broadcast.add(),U.setHeader(),U.mode.change({mode:"/say"}),q.heartbeat.enabled=1},q.questDelay)},openFirstTwoZones:function(){for(var i=0;i<2;i++){var a=e(".mission-zone").eq(i).get(0);a!==j&&a.click()}}},ae={go:function(){"dungeon"!==O.view&&(q.emptyScenesExcept("scene-dungeon"),U.broadcast.remove(),Y.channel&&V.unsubscribe(U.getChannel()),Y.channel="","/say"===U.mode.command&&U.mode.change({mode:"/party"}),U.size.small(),O.setScene("dungeon"),ae.init(),console.info("DUNGEON GO"),n.to("#scene-dungeon",.5,{delay:1,opacity:1}))},initialized:0,init:function(){Y.zoneMobs.length&&Y.zoneMobs.forEach(function(e){$.preload.mob(e)}),ae.initialized?a.getElementById("scene-dungeon").style.display="block":(a.getElementById("scene-dungeon").innerHTML=ae.html(),_.events(),oe.init()),U.scrollBottom()},events:function(){},html:function(){return'<img id="dungeon-bg" class="img-bg" src="img2/dungeon/braxxen1.jpg">'},enterCombat:function(){console.info("ENTERING COMBAT")}},te={ALL:{route:function(e){var i=te[Y.job].skillKeys[e];te.RNG[i]()},pull:function(){console.info("skills.pull")},toggleAutoAttack:function(){console.info("toggleAutoAttack")}},WAR:{bash:function(){console.info("bash")},taunt:function(){console.info("taunt")},kick:function(){console.info("kick")},demoralize:function(){console.info("demoralize")},tearAsunder:function(){console.info("tearAsunder")},shout:function(){console.info("shout")},warCry:function(){console.info("warCry")},warStomp:function(){console.info("warStomp")}},PAL:{layHands:function(){console.info("layHands")},bash:function(){console.info("bash")},taunt:function(){console.info("taunt")},heal:function(){console.info("heal")},blessedHammer:function(){console.info("blessedHammer")},smite:function(){console.info("smite")},resolution:function(){console.info("resolution")},holyMight:function(){console.info("holyMight")}},SHD:{harmTouch:function(){console.info("harmTouch")},bash:function(){console.info("bash")},taunt:function(){console.info("taunt")},lifeTap:function(){console.info("lifeTap")},engulfingDarkness:function(){console.info("engulfingDarkness")},bloodBoil:function(){console.info("bloodBoil")},invokeFear:function(){console.info("invokeFear")},waveOfHorror:function(){console.info("waveOfHorror")}},RNG:{trueshotStrike:function(){console.info("trueshotStrike")},kick:function(){console.info("kick")},ensnare:function(){console.info("ensnare")},ignite:function(){console.info("ignite")},faerieFlame:function(){console.info("faerieFlame")},carelessLightning:function(){console.info("carelessLightning")},healing:function(){console.info("healing")},feetLikeCat:function(){console.info("feetLikeCat")}},MNK:{roundhouseKick:function(){console.info("roundhouseKick")},mend:function(){console.info("mend")},feignDeath:function(){console.info("feignDeath")},intimidation:function(){console.info("intimidation")},chiBlast:function(){console.info("chiBlast")},shoryuken:function(){console.info("shoryuken")},hadoken:function(){console.info("hadoken")},nirvana:function(){console.info("nirvana")}},ROG:{backstab:function(){console.info("backstab")},evade:function(){console.info("evade")},widowStrike:function(){console.info("widowStrike")},flashPowder:function(){console.info("flashPowder")},shadowStrike:function(){console.info("shadowStrike")},mirrorStrike:function(){console.info("mirrorStrike")},crossSlash:function(){console.info("crossSlash")},awestruck:function(){console.info("awestruck")}},DRU:{healing:function(){console.info("healing")},starfire:function(){console.info("starfire")},skinLikeWood:function(){console.info("skinLikeWood")},driftingDeath:function(){console.info("driftingDeath")},tornado:function(){console.info("tornado")},endureLightning:function(){console.info("endureLightning")},lightningBlast:function(){console.info("lightningBlast")},chloroplast:function(){console.info("chloroplast")}},CLR:{holyMight:function(){console.info("holyMight")},smite:function(){console.info("smite")},blessedHammer:function(){console.info("blessedHammer")},healing:function(){console.info("healing")},resolution:function(){console.info("resolution")},symbolOfYentus:function(){console.info("symbolOfYentus")},endureBleed:function(){console.info("endureBleed")},armorOfFaith:function(){console.info("armorOfFaith")}},SHM:{healing:function(){console.info("healing")},frostRift:function(){console.info("frostRift")},devouringPlague:function(){console.info("devouringPlague")},drowsy:function(){console.info("drowsy")},spiritOfTheBear:function(){console.info("spiritOfTheBear")},bloodRitual:function(){console.info("bloodRitual")},endureCold:function(){console.info("endureCold")},talismanOfTrogmaar:function(){console.info("talismanOfTrogmaar")}},BRD:{chantOfBattle:function(){console.info("chantOfBattle")},hymnOfRestoration:function(){console.info("hymnOfRestoration")},boastfulBellow:function(){console.info("boastfulBellow")},consonantChain:function(){console.info("consonantChain")},lucidLullaby:function(){console.info("lucidLullaby")},elementalRhythms:function(){console.info("elementalRhythms")},chorusOfClarity:function(){console.info("chorusOfClarity")},sirensSong:function(){console.info("sirensSong")}},NEC:{engulfingDarkness:function(){console.info("engulfingDarkness")},invokeDeath:function(){console.info("invokeDeath")},venomBolt:function(){console.info("venomBolt")},bloodBoil:function(){console.info("bloodBoil")},invokeFear:function(){console.info("invokeFear")},lifeTap:function(){console.info("lifeTap")},endurePoison:function(){console.info("endurePoison")},dyingBreath:function(){console.info("dyingBreath")}},ENC:{discordantMind:function(){console.info("discordantMind")},colorShift:function(){console.info("colorShift")},alacrity:function(){console.info("alacrity")},dazzle:function(){console.info("dazzle")},gaspingEmbrace:function(){console.info("gaspingEmbrace")},clarity:function(){console.info("clarity")},cajolingWhispers:function(){console.info("cajolingWhispers")},mysticRune:function(){console.info("mysticRune")}},MAG:{lavaBolt:function(){console.info("lavaBolt")},summonElemental:function(){console.info("summonElemental")},frozenOrb:function(){console.info("frozenOrb")},elementalFury:function(){console.info("elementalFury")},psionicStorm:function(){console.info("psionicStorm")},malaise:function(){console.info("malaise")},endureFire:function(){console.info("endureFire")},stasisField:function(){console.info("stasisField")}},WIZ:{iceBolt:function(){console.info("iceBolt")},arcaneMissiles:function(){console.info("arcaneMissiles")},manaShield:function(){console.info("manaShield")},fireball:function(){console.info("fireball")},viziersShielding:function(){console.info("viziersShielding")},lightningStrike:function(){console.info("lightningStrike")},glacialSpike:function(){console.info("glacialSpike")},mirrorImages:function(){console.info("mirrorImages")}}};!function(){var e=O.getJobShortKeys();for(var i in te)if(e.indexOf(i)>-1){te[i].skillKeys=E.keys(te[i]),te[i].skillKeys.unshift("toggleAutoAttack"),te[i].skillKeys.unshift("pull");for(var a in te.ALL)te[i][a]=te.ALL[a]}}();var ne={missionUpdate:function(i){console.info("MISSION UPDATE! ",i),ie.setQuest(i.quest),Y.zoneMobs=i.zoneMobs,Y.p_id&&!Y.party[0].isLeader&&e.ajax({data:{quest:i.quest},url:app.url+"php2/mission/update-quest.php"}).done(function(e){console.info("missionUpdate ",e),"town-mission"===Z.aside.selected&&ie.showEmbark(),ie.updateTitle(),U.log("Now departing for "+Y.quest.zone+"...","chat-warning"),n.to("#scene-town",3,{startAt:{opacity:1},delay:2,opacity:0,ease:d.easeOut}),v(function(){ie.embark()},q.questDelay)})},length:function(){var e=0;return Y.party.forEach(function(i){i.name&&e++}),e},isSoloOrLeading:function(){var e=0,i=ne.length();return(1===i||i>1&&Y.party[0].isLeader)&&(e=1),e},notifyMissionStatus:function(e){O.msg(e.msg,6),"abandon"===e.action&&ie.abort()},promotePlayer:function(){if(ne.length()>1){var e="";Y.party.forEach(function(i,a){a&&i&&(e=i.name)}),e&&U.sendMsg("/promote "+e)}}},oe={initialized:0,wrap:a.getElementById("button-wrap"),init:function(){for(var i="",a=0;a<10;a++)i+='<div id="class-btn-'+a+'" class="class-btn" style="background-image: url(img2/skills/'+Y.job+'.png)"></div>';oe.wrap.innerHTML=i,oe.initialized||(e("#button-wrap").on(z.click,".class-btn",function(){var e=1*this.id.substr(10);console.info("CLICKED SKILL: ",e,typeof e),te[Y.job].route(e)}),v(function(){n.to(oe.wrap,1,{startAt:{display:"flex"},bottom:0})},1e3))},hide:function(){n.set(oe.wrap,{display:"none"})}},le={chat:{id:999999999,room:function(){for(var e=0;e<100;e++){var a=O.toJobShort(O.jobs[~~(14*i.random())]);V.zmq.publish(U.getChannel(),{route:"chat->add",row:le.chat.id+e,level:i.ceil(50*i.random()),job:a,name:"WWWWWWWWWWWWWWWW"})}},log:function(){for(var e=0;e<10;e++)U.sendMsg("/flist")}},orcs:function(){e("#title-container-wrap").css("display","none");for(var t=a.getElementById("ng2-logo-wrap"),n=0;n<1e3;n++){var l=a.createElement("img");l.id="mob"+n,l.className="abs",l.style.top=~~(600*i.random())+"px",l.style.left=~~(900*i.random())+"px",l.src="images/an orc.png",t.appendChild(l)}for(n=0;n<1e3;n++)!function(){var e=a.getElementById("mob"+n),t={hue:"hue-rotate(0deg)"};new o({onUpdate:function(){t.hueRotate(e,t)},repeat:-1}).to(t,6*i.random()+1,{hue:"hue-rotate(360deg)"})}()},filters:{hueRotate:function(e,i){e.style.filter="grayscale(100%) sepia(100%) saturate(1000%) "+i.hue},death:function(e,i){e.style.filter=i.opacity+" "+i.brightness},effect:function(e,i,a){e.style.filter=i[a]}},battle:function(){Q.test=1,_.testInit()}}}($,Math,document,location,TweenMax,TimelineMax,Power0,Power1,Power2,Power3,Power4,Back,Elastic,Bounce,SteppedEase,Circ,Expo,Sine,setTimeout,setInterval,clearTimeout,clearInterval,void 0===window.webkitRequestAnimationFrame||webkitRequestAnimationFrame,void 0===window.webkitCancelAnimationFrame||webkitCancelAnimationFrame,getComputedStyle,requestAnimationFrame,cancelAnimationFrame,window,Array,JSON,Date,Object,void 0);